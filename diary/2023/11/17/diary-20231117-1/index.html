<!DOCTYPE HTML>
<html lang="zh-CN">
    


<head><meta name="generator" content="Hexo 3.9.0">
    <meta charset="utf-8">
    <meta name="keywords" content="VS的C/C++开发和MFC, 车舟慢">
    <meta name="baidu-site-verification" content="fmlEuI34ir">
    <meta name="google-site-verification" content="KeoTn_OFy4ndJwXNmm2gMeQfPhd7alqE9vQDwI32KCY">
    <meta name="description" content="VisualStudio操作打开编辑的文件跟解决方案资源管理器同步显示，方便定位正在查看修改的文件  
主菜单:工具-选项-项目和解决方案-在解决方案资源管理器中跟踪活动项 勾上  

vs2015关于MFC的操作相关联的.h和.cpp快速">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>VS的C/C++开发和MFC | 车舟慢</title>
    <link rel="icon" type="image/png" href="/diary/favicon.png">

    <link rel="stylesheet" type="text/css" href="/diary/libs/awesome/css/font-awesome.min.css">
    <link rel="stylesheet" type="text/css" href="/diary/libs/materialize/materialize.min.css">
    <link rel="stylesheet" type="text/css" href="/diary/libs/aos/aos.css">
    <link rel="stylesheet" type="text/css" href="/diary/libs/animate/animate.min.css">
    <link rel="stylesheet" type="text/css" href="/diary/libs/lightGallery/css/lightgallery.min.css">
    <link rel="stylesheet" type="text/css" href="/diary/css/matery.css">
    <link rel="stylesheet" type="text/css" href="/diary/css/my.css">
    
    <style type="text/css">
        
    </style>

    <script src="/diary/libs/jquery/jquery-2.2.0.min.js"></script>
    <script src="https://sdk.jinrishici.com/v2/browser/jinrishici.js" charset="utf-8"></script>
    
    <script>
        var _hmt = _hmt || [];
        (function () {
            var hm = document.createElement("script");
            hm.src = "https://hm.baidu.com/hm.js?46e79e71af0709a5b9106bf20cecc493";
            var s = document.getElementsByTagName("script")[0];
            s.parentNode.insertBefore(hm, s);
        })();
    </script>

    
    
        <script>
            (function(){
                var bp = document.createElement('script');
                var curProtocol = window.location.protocol.split(':')[0];
                if (curProtocol === 'https') {
                    bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
                }
                else {
                    bp.src = 'http://push.zhanzhang.baidu.com/push.js';
                }
                var s = document.getElementsByTagName("script")[0];
                s.parentNode.insertBefore(bp, s);
            })();
        </script>
    

<link rel="stylesheet" href="/diary/css/prism-tomorrow.css" type="text/css">
<link rel="stylesheet" href="/diary/css/prism-line-numbers.css" type="text/css"></head>

    <body>

        <header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper container">
            <div class="brand-logo">
                <a href="/diary/" class="waves-effect waves-light">
                    
                    <img src="/diary/medias/logo.png" class="logo-img" alt="LOGO">
                    
                    <span class="logo-span">车舟慢</span>
                </a>
            </div>
            


<!-- <a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fa fa-navicon"></i></a>
<ul class="right">
    
    <li class="hide-on-med-and-down">
        <a href="/diary/" class="waves-effect waves-light">
            
            <i class="fa fa-home"></i>
            
            <span>首页</span>
        </a>
    </li>
    
    <li class="hide-on-med-and-down">
        <a href="/diary/categories" class="waves-effect waves-light">
            
            <i class="fa fa-bookmark"></i>
            
            <span>分类</span>
        </a>
    </li>
    
    <li class="hide-on-med-and-down">
        <a href="/diary/archives" class="waves-effect waves-light">
            
            <i class="fa fa-archive"></i>
            
            <span>归档</span>
        </a>
    </li>
    
    <li class="hide-on-med-and-down">
        <a href="/diary/demo/shuoshuo" class="waves-effect waves-light">
            
            <i class="fa fa-music"></i>
            
            <span>说说</span>
        </a>
    </li>
    
    <li class="hide-on-med-and-down">
        <a href="/diary/galleries" class="waves-effect waves-light">
            
            <i class="fa fa-photo"></i>
            
            <span>相册</span>
        </a>
    </li>
    
    <li>
        <a href="#searchModal" class="modal-trigger waves-effect waves-light">
            <i id="searchIcon" class="fa fa-search" title="搜索"></i>
        </a>
    </li>
</ul> -->

<!-- 支持二级菜单特性  -->
<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fa fa-navicon"></i></a>
<ul class="right nav-menu">
    
      <li class="hide-on-med-and-down nav-item" >

        
            <a href="/diary/" class="waves-effect waves-light">
              
                <i class="fa fa-home"></i>
              
              <span>首页</span>
            </a>

            
      </li>
    
      <li class="hide-on-med-and-down nav-item" >

        
            <a href="/diary/categories" class="waves-effect waves-light">
              
                <i class="fa fa-bookmark"></i>
              
              <span>分类</span>
            </a>

            
      </li>
    
      <li class="hide-on-med-and-down nav-item" >

        
            <a href="/diary/archives" class="waves-effect waves-light">
              
                <i class="fa fa-archive"></i>
              
              <span>归档</span>
            </a>

            
      </li>
    
      <li class="hide-on-med-and-down nav-item" >

        
            <a href="/diary/demo/shuoshuo" class="waves-effect waves-light">
              
                <i class="fa fa-music"></i>
              
              <span>说说</span>
            </a>

            
      </li>
    
      <li class="hide-on-med-and-down nav-item" >

        
            <a href="/diary/galleries" class="waves-effect waves-light">
              
                <i class="fa fa-photo"></i>
              
              <span>相册</span>
            </a>

            
      </li>
    

    <li>
        <a href="#searchModal" class="modal-trigger waves-effect waves-light">
            <i id="searchIcon" class="fa fa-search" title="搜索"></i>
        </a>
    </li>

</ul>

<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <img src="/diary/medias/logo.png" class="logo-img circle responsive-img">
        
        <div class="logo-name">车舟慢</div>
        <div class="logo-desc">
            
            雁引愁心去，山衔好月来。
            
        </div>
    </div>

    

    <ul class="menu-list mobile-menu-list">
        
        <li>
            <a href="/diary/" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-home"></i>
                
                首页
            </a>
        </li>
        
        <li>
            <a href="/diary/categories" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-bookmark"></i>
                
                分类
            </a>
        </li>
        
        <li>
            <a href="/diary/archives" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-archive"></i>
                
                归档
            </a>
        </li>
        
        <li>
            <a href="/diary/demo/shuoshuo" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-music"></i>
                
                说说
            </a>
        </li>
        
        <li>
            <a href="/diary/galleries" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-photo"></i>
                
                相册
            </a>
        </li>
        
        
    </ul>

   
   
<!-- 支持二级菜单特性   -->
<!-- <ul class="menu-list mobile-menu-list">
    
        <li class="m-nav-item">
                
                    <a href="/diary/" class="waves-effect waves-light">
                        
                        <i class="fa fa-fw fa-home"></i>
                        
                        首页
                    </a>
              
            </li>
        
        <li class="m-nav-item">
                
                    <a href="/diary/categories" class="waves-effect waves-light">
                        
                        <i class="fa fa-fw fa-bookmark"></i>
                        
                        分类
                    </a>
              
            </li>
        
        <li class="m-nav-item">
                
                    <a href="/diary/archives" class="waves-effect waves-light">
                        
                        <i class="fa fa-fw fa-archive"></i>
                        
                        归档
                    </a>
              
            </li>
        
        <li class="m-nav-item">
                
                    <a href="/diary/demo/shuoshuo" class="waves-effect waves-light">
                        
                        <i class="fa fa-fw fa-music"></i>
                        
                        说说
                    </a>
              
            </li>
        
        <li class="m-nav-item">
                
                    <a href="/diary/galleries" class="waves-effect waves-light">
                        
                        <i class="fa fa-fw fa-photo"></i>
                        
                        相册
                    </a>
              
            </li>
        

        
    </ul> -->

</div>

        </div>

        
    </nav>

</header>

        
<script src="/diary/libs/cryptojs/crypto-js.min.js"></script>
<script>
    (function() {
        let pwd = '';
        if (pwd && pwd.length > 0) {
            if (pwd !== CryptoJS.SHA256(prompt('请输入访问本文章的密码')).toString(CryptoJS.enc.Hex)) {
                alert('密码错误，将返回主页！');
                location.href = '/diary/';
            }
        }
    })();
</script>




<div class="bg-cover pd-header post-cover" style="background-image: url('/diary/medias/featureimages/1.jpg')">
    <div class="container">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <div class="description center-align post-title">
                        VS的C/C++开发和MFC
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>



<main class="post-container content">

    
    <link rel="stylesheet" href="/diary/libs/tocbot/tocbot.css">
<style>
    #articleContent h1::before,
    #articleContent h2::before,
    #articleContent h3::before,
    #articleContent h4::before,
    #articleContent h5::before,
    #articleContent h6::before {
        display: block;
        content: " ";
        height: 100px;
        margin-top: -100px;
        visibility: hidden;
    }

    #articleContent :focus {
        outline: none;
    }

    .toc-fixed {
        position: fixed;
        top: 64px;
    }

    .toc-widget {
        padding-left: 20px;
    }

    .toc-widget .toc-title {
        margin: 35px 0 15px 0;
        padding-left: 17px;
        font-size: 1.5rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    .toc-widget ol {
        padding: 0;
        list-style: none;
    }

    #toc-content ol {
        padding-left: 10px;
    }

    #toc-content ol li {
        padding-left: 10px;
    }

    #toc-content .toc-link:hover {
        color: #42b983;
        font-weight: 700;
        text-decoration: underline;
    }

    #toc-content .toc-link::before {
        background-color: transparent;
        max-height: 25px;
    }

    #toc-content .is-active-link {
        color: #42b983;
    }

    #toc-content .is-active-link::before {
        background-color: #42b983;
    }

    #floating-toc-btn {
        position: fixed;
        right: 20px;
        bottom: 76px;
        padding-top: 15px;
        margin-bottom: 0;
        z-index: 998;
    }

    #floating-toc-btn .btn-floating {
        width: 48px;
        height: 48px;
    }

    #floating-toc-btn .btn-floating i {
        line-height: 48px;
        font-size: 1.4rem;
    }
</style>
<div class="row">
    <div id="main-content" class="col s12 m12 l9">
        <!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                    <div class="article-tag">
                        
                            <a href="/diary/tags/MFC/" target="_blank">
                                <span class="chip bg-color">MFC</span>
                            </a>
                        
                            <a href="/diary/tags/libcurl/" target="_blank">
                                <span class="chip bg-color">libcurl</span>
                            </a>
                        
                            <a href="/diary/tags/共享文件夹/" target="_blank">
                                <span class="chip bg-color">共享文件夹</span>
                            </a>
                        
                    </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                </div>
            </div>
            
            <div class="post-info">
                <div class="post-date info-break-policy">
                    <i class="fa fa-calendar-minus-o fa-fw"></i>发布日期:&nbsp;&nbsp;
                    2023-11-17
                </div>

                <div class="post-author info-break-policy">
                    <i class="fa fa-user-o fa-fw"></i>作者:&nbsp;&nbsp;
                    
                        sean
                    
                </div>

                
                    
                    <div class="info-break-policy">
                        <i class="fa fa-file-word-o fa-fw"></i>文章字数:&nbsp;&nbsp;
                        18.3k
                    </div>
                    

                    
                    <div class="info-break-policy">
                        <i class="fa fa-clock-o fa-fw"></i>阅读时长:&nbsp;&nbsp;
                        90 分
                    </div>
                    
                
                
                

            </div>
        </div>
        <hr class="clearfix">
        <div class="card-content article-card-content">
            <div id="articleContent">
                <h2 id="VisualStudio操作"><a href="#VisualStudio操作" class="headerlink" title="VisualStudio操作"></a>VisualStudio操作</h2><p>打开编辑的文件跟解决方案资源管理器同步显示，方便定位正在查看修改的文件  </p>
<pre class="line-numbers language-html"><code class="language-html">主菜单:工具-选项-项目和解决方案-在解决方案资源管理器中跟踪活动项 勾上  
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h2 id="vs2015关于MFC的操作"><a href="#vs2015关于MFC的操作" class="headerlink" title="vs2015关于MFC的操作"></a>vs2015关于MFC的操作</h2><pre class="line-numbers language-html"><code class="language-html">相关联的.h和.cpp快速切换  
右键点击"切换标题/代码文件"进行切换

在资源视图里找到相关控件，选中控件，右键属性可查ID,右键"类向导"可查看到已关联的类名
在类视图里可根据类名找到类，然后进入类的h或cpp进行切换查看
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="MFC使用CAsyncSocket"><a href="#MFC使用CAsyncSocket" class="headerlink" title="MFC使用CAsyncSocket"></a>MFC使用CAsyncSocket</h3><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="../../../../images/2024/UseCAsyncSocket.jpg" alt="CAsyncSocket一般使用步骤"></p>
<p>MFC类库中，几乎封装了Windows Sockets的全部功能，在微软基础类库中有两个基础类：CAsyncSocket类封装了异步套接字（非阻塞模式）的基本功能；CSocket类派生于CAsyncSocket类，具有串行化功能（阻塞模式）。</p>
<pre class="line-numbers language-html"><code class="language-html">CAsyncSocket类实现数据传输步骤:  
(1)调用构造函数创建套接字对象  
(2)  
如果创建服务器套接字，则调用Bind()函数绑定本地IP和端口，然后调用Listen()函数监听客户端请求。如果请求到来，则调用Accept()函数响应该请求。
如果创建客户端套接字，则直接调用函数Connect()连接服务器即可；
(3)调用Send()等功能函数进行数据传输与处理  
(4)关闭或销毁套接字对象  

CSocket类实现数据传输步骤:  
(1)创建CSocket类对象  
(2)  
如果创建服务器端套接字，则调用Bind()函数绑定本地IP和端口，然后调用Listen()函数监听客户端请求。如果请求到来，则调用Accept()函数响应该请求。  
如果创建客户端套接字，则直接调用函数Connect()连接服务器即可  
(3)创建与CSocket类对象相关联的CSocketFile类对象  
(4)创建与CSocket类对象相关联的CArchive类对象  
(5)使用CArchive类对象在客户端和服务器之间进行数据传输  
(6)关闭或销毁CSocket类，CSocketFile类，CArchive类三个对象  

上述两种步骤均为使用微软类库进行开发流程，使用MFC通信开发调用MFC封装类库即可
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="CTCPClientSocket支持同步通信模式和异步通信模式"><a href="#CTCPClientSocket支持同步通信模式和异步通信模式" class="headerlink" title="CTCPClientSocket支持同步通信模式和异步通信模式"></a>CTCPClientSocket支持同步通信模式和异步通信模式</h4><p>同步通信模式通过阻塞等待数据的发送和接收完成来进行通信，适合简单的、序列化的操作。<br>异步通信模式则使用消息机制，允许程序在等待数据的同时处理其他任务，适合需要并发处理多个连接或实时响应事件的情况。</p>
<pre class="line-numbers language-html"><code class="language-html">1. 同步通信模式:  
    > 调用发送和接收函数时，程序会阻塞等待数据的发送和接收完成。
    > 发送数据时，调用 Send 函数将数据发送到远程主机，并在数据发送完成后返回。
    > 接收数据时，调用 Receive 函数从远程主机接收数据，并在接收完成后返回。
    > 同步通信模式适用于需要在发送或接收数据完成后才能继续执行后续操作的情况。  

2. 异步通信模式:  
    > 在异步通信模式下，通过调用AsyncSelect函数来启用异步通知机制，指定感兴趣的事件类型（如 FD_READ、FD_WRITE、FD_CLOSE）。  
    > 当有相关事件发生时，系统会发送一个消息（WM_ASYNC_SOCKET_NOTIFY）给拥有窗口句柄的线程，通过消息映射和处理函数来处理相应的事件。  
    > 异步通信模式下，发送和接收函数是非阻塞的，它们会立即返回，不会阻塞程序的执行。  
    > 当有数据可读时，系统会发送 FD_READ 消息，然后可以调用 Receive 函数来接收数据。  
    > 当发送缓冲区空闲时，系统会发送 FD_WRITE 消息，然后可以调用 Send 函数来发送数据。  
    > 当连接关闭或出现错误时，系统会发送 FD_CLOSE 消息，然后可以调用 Close 函数来关闭连接。  
    > 异步通信模式适用于需要同时处理多个连接或需要实时响应事件的情况。  
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="CTCPClientSocket用法1"><a href="#CTCPClientSocket用法1" class="headerlink" title="CTCPClientSocket用法1"></a>CTCPClientSocket用法1</h4><p>新建一个MFC应用程序<br>在“解决方案资源管理器”中，右键单击需要添加类的项目文件夹，然后选择“添加”-&gt;“类”<br>在“添加类”对话框中，选择“VisualC++”-&gt;”MFC”-&gt;”MFC类”，然后点击“添加”。<br>进入“MFC添加类向导”对话框中，输入类名CMyAsyncSocket，h文件：MyAsyncSocket.h cpp文件：MyAsyncSocket.cpp 基类选择CAsyncSocket </p>
<h2 id="MFC使用CFrameWndEx创建程序"><a href="#MFC使用CFrameWndEx创建程序" class="headerlink" title="MFC使用CFrameWndEx创建程序"></a>MFC使用CFrameWndEx创建程序</h2><h3 id="创建新的MFC应用程序项目"><a href="#创建新的MFC应用程序项目" class="headerlink" title="创建新的MFC应用程序项目"></a>创建新的MFC应用程序项目</h3><pre class="line-numbers language-html"><code class="language-html">1. 打开Visual Studio，并选择 "创建新项目"  
2. 在 "创建新项目" 对话框中，选择 "Visual C++" -> "MFC" -> "MFC应用程序"。  
3. 输入项目名称和位置，然后点击 "确定"  
4. 在 "应用程序类型" 页面上，选择 "单文档" 或 "多文档" 应用程序，(项目类型建议"MFC标准"，界面比较简洁)然后点击 "完成"  
5. 在解决方案资源管理器中，展开 "源文件" 文件夹,双击打开以 "View" 结尾的类文件（例如，"MainFrm.cpp"）  
6. 找到类定义行，类似于 class CMainFrame : public CFrameWnd,将基类修改为 CFrameWndEx，即 class CMainFrame : public CFrameWndEx  
7. 添加 "Hello World" 文本显示  
在 CMainFrame 类的 Create() 函数中，找到以下代码行  
if (!CFrameWnd::Create(
   nullptr, // 窗口标题
   _T("Hello MFC"), // 窗口类名
   WS_OVERLAPPEDWINDOW,
   rectDefault, 
   nullptr,
   nullptr))
在此代码块的前面或后面，添加以下代码行来创建一个静态文本控件，并显示 "Hello World" 文本：  
CStatic* pLabel = new CStatic;
pLabel->Create(_T("Hello World"), WS_CHILD | WS_VISIBLE, CRect(10, 10, 200, 30), this);

8. 构建和运行程序  
点击 Visual Studio 工具栏上的 "生成解决方案" 按钮，确保没有编译错误  

以上步骤是一个简单的示例，用于演示如何在MFC中使用CFrameWndEx。你可以根据自己的需求进一步定制主窗口的外观和功能。  
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>MFC状态栏CMFCStatusBar  </p>
<pre class="line-numbers language-html"><code class="language-html">MFC应用程序项目中打开你想要添加状态栏的视图或对话框类
在其头文件中包含 afxwin.h 和 afxcmn.h 头文件
#include <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>afxwin.h</span><span class="token punctuation">></span></span>
#include <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>afxcmn.h</span><span class="token punctuation">></span></span>  
定义一个CMFCStatusBar成员变量：  
private:
   CMFCStatusBar m_wndStatusBar;  
在窗口的 OnCreate() 函数中创建状态栏并添加信息  
int CMyView::OnCreate(LPCREATESTRUCT lpCreateStruct)
{
   if (CView::OnCreate(lpCreateStruct) == -1)
      return -1;
   // 创建状态栏
   if (!m_wndStatusBar.Create(this))
   {
      TRACE0("无法创建状态栏\n");
      return -1;      
   }
   // 设置状态栏信息
   m_wndStatusBar.SetPaneText(0, _T("Hello World"));
   return 0;
}

<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="cmd批处理"><a href="#cmd批处理" class="headerlink" title="cmd批处理"></a>cmd批处理</h2><p>显示当前电脑ip  </p>
<pre class="line-numbers language-html"><code class="language-html">//show_ip.bat :  
@echo off
ipconfig | findstr /i "IPv4 Address"
pause
双击运行bat文件即可
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="实操c-Tips"><a href="#实操c-Tips" class="headerlink" title="实操c++Tips"></a>实操c++Tips</h2><h3 id="命令行接收自定义指令"><a href="#命令行接收自定义指令" class="headerlink" title="命令行接收自定义指令"></a>命令行接收自定义指令</h3><pre class="line-numbers language-html"><code class="language-html">#include <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>string</span><span class="token punctuation">></span></span>
#include <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>iostream</span><span class="token punctuation">></span></span>
#include <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>stdio.h</span><span class="token punctuation">></span></span>
int main() {  
    while(true){
        std::string opt;
        std::cout &lt;&lt; "$ >";
        std::getline(std::cin,opt);
        if(opt.empty()){
            continue;
        }
        if(opt == "exit"){
            std::cout &lt;&lt; "*** exit ***" &lt;&lt; std::endl;
            break;
        }

        char ip[256] ={0};
        // 使用 sscanf 解析输入字符串
        if (sscanf(opt.c_str(), "hConnectService %s", ip) == 1) {
            std::cout &lt;&lt; "*** hConnectService "&lt;&lt; ip &lt;&lt; " ***" &lt;&lt; std::endl;
            continue;
        } 
        std::cout &lt;&lt; "*** UnKnown command ***" &lt;&lt; std::endl;
    }
    return 0;
}
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="std-function"><a href="#std-function" class="headerlink" title="std::function"></a>std::function</h3><p>std::function 是一个函数包装器，它可以用来存储和调用任何可调用对象，例如函数指针、函数对象、Lambda 表达式等。  </p>
<pre class="line-numbers language-html"><code class="language-html">如 std::function<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>void(const</span> <span class="token attr-name">HResutl&amp;)</span><span class="token punctuation">></span></span> OnRealPos  
在这个函数定义中，std::function 定义了一个函数对象类型，该类型具有返回类型为 void，参数类型为 const HResult&amp; 的函数签名
意味着你可以将符合条件的函数或函数对象赋值给 OnRealPos
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<h3 id="std-shared-ptr"><a href="#std-shared-ptr" class="headerlink" title="std::shared_ptr"></a>std::shared_ptr</h3><p>std::shared_ptr是C++标准库中的一个智能指针类模板，用于管理动态分配的对象的生命周期。它提供了自动内存管理和资源释放的机制，以防止内存泄漏和野指针访问。  </p>
<p>使用std::shared_ptr可以共享拥有一个对象的所有权，即多个std::shared_ptr实例可以同时指向同一个对象。它通过引用计数的方式跟踪对象的引用次数，当引用计数变为零时，即没有任何 std::shared_ptr 实例指向该对象时，会自动释放对象所占用的内存。<br>以下是 std::shared_ptr 的基本用法：  </p>
<pre class="line-numbers language-html"><code class="language-html">#include <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>memory</span><span class="token punctuation">></span></span>

// 创建一个动态分配的对象，并用 shared_ptr 进行管理
std::shared_ptr<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>int</span><span class="token punctuation">></span></span> ptr = std::make_shared<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>int</span><span class="token punctuation">></span></span>(42);

// 通过 shared_ptr 访问对象
int value = *ptr;

// 通过 shared_ptr 共享对象的所有权
std::shared_ptr<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>int</span><span class="token punctuation">></span></span> otherPtr = ptr;

// 获取对象的引用计数
int count = ptr.use_count();
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="typedef-struct-HContext"><a href="#typedef-struct-HContext" class="headerlink" title="typedef struct{}* HContext"></a>typedef struct{}* HContext</h3><pre class="line-numbers language-html"><code class="language-html">定义了一个指向空结构体的指针类型 HContext  
这个结构体类型不包含任何成员，因此在内存中的大小为 0。但是，即使结构体类型为空，它在 C 语言中仍然是一个合法的类型  
通过 typedef 关键字将 struct{}* 定义为一个指向空结构体的指针类型，然后用 HContext 来代替 struct{}*，从而定义了一个名为 HContext 的指针类型。这个指针类型可以用来指向某个实际类型为“空结构体”的结构体变量，或者作为函数参数或返回值类型。  

通常情况下，我们使用“空结构体”的目的是为了定义一个标识符，用于区分不同的指针类型。因为在 C 语言中，只要两个指针类型的名称不同，它们就是不同的类型，即使它们指向的是相同的数据类型。因此，通过定义一个新的指针类型，我们可以将其用作标识符，区分不同的指针类型，从而增加代码的可读性和可维护性。

举例
struct Context{
    std::shared_ptr<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>XXXXProxy</span><span class="token punctuation">></span></span> proxy;

    hCbRecordTime onRecTime;
    hCbRealPos onPos;
    hCbDistance onDist;
    hCbFileSize onFileSize;
    hCbMessage onMessage;

    Context(){
        onRecTime = NULL;
        onPos = NULL;
        onDist = NULL;
        onFileSize = NULL;
        onMessage = NULL;
    }
};
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="根据宏定义导入导出函数"><a href="#根据宏定义导入导出函数" class="headerlink" title="根据宏定义导入导出函数"></a>根据宏定义导入导出函数</h3><blockquote>
<p>在创建动态链接库（DLL）时使用 __declspec(dllexport) 来指定需要导出的函数或变量，<br>在使用该 DLL 的应用程序中则需要使用 __declspec(dllimport) 来指定需要导入的函数或变量.  </p>
</blockquote>
<pre class="line-numbers language-html"><code class="language-html">// mymath.h:  
#ifdef MYMATH_EXPORTS
#define MYMATH_API __declspec(dllexport)
#else
#define MYMATH_API __declspec(dllimport)
#endif

extern "C" MYMATH_API int Add(int a, int b);

// mymath.cpp:
#include "mymath.h"

int Add(int a, int b)
{
    return a + b;
}

// 创建一个使用这个DLL的应用程序:
// main.cpp
#include <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>iostream</span><span class="token punctuation">></span></span>
#include "mymath.h"

int main()
{
    int result = Add(3, 4);
    std::cout &lt;&lt; "Result: " &lt;&lt; result &lt;&lt; std::endl;
    return 0;
}

在实际项目中，你可能需要在 Visual Studio 中设置导出宏 MYMATH_EXPORTS，以便在编译 DLL 时正确定义 MYMATH_API。
1. 打开 Visual Studio，并打开包含你的 DLL 项目的解决方案。
2. 在解决方案资源管理器中，找到你的 DLL 项目，并右键单击该项目，选择“属性”（或使用快捷键 Alt + Enter）。
3. 在弹出的属性页面中，选择“配置属性” > “C/C++” > “预处理器”。
4. 在“预处理器定义”一栏中，点击“编辑”按钮（可能显示为三个点 (...)），然后在弹出的对话框中点击“添加”按钮。
5. 在“添加定义”对话框中，输入MYMATH_EXPORTS，然后点击“确定”按钮关闭对话框。  
通过以上步骤，你已经成功地设置了导出宏 MYMATH_EXPORTS。这将确保在编译 DLL 时正确定义 MYMATH_API 为 __declspec(dllexport)，从而正确导出函数或变量。

请记得在设置完宏定义后保存项目属性，并重新编译你的 DLL 项目，以便使修改生效。
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="vscode开发c-时指定头文件和lib文件"><a href="#vscode开发c-时指定头文件和lib文件" class="headerlink" title="vscode开发c++时指定头文件和lib文件"></a>vscode开发c++时指定头文件和lib文件</h3><p>头文件放include目录下，库文件lib放libs目录下，<br>include和libs一起放在sdk目录下<br>sdk目录放在vscode工程根目录下</p>
<pre class="line-numbers language-html"><code class="language-html">// 配置tasks.json
{
    "version": "2.0.0",
    "tasks": [
        {
            "type": "cppbuild",
            "label": "C/C++: cl.exe build active file",
            "command": "cl.exe",
            "args": [
                "-I",
                "F:/Download/cproject/sdk/include",
                "-L",
                "F:/Download/cproject/sdk/libs",
                "/Zi",
                "/EHsc",
                "/nologo",
                "/Fe${fileDirname}\\${fileBasenameNoExtension}.exe",
                "${file}"
            ],
            "options": {
                "cwd": "${fileDirname}"
            },
            "problemMatcher": [
                "$msCompile"
            ],
            "group": "build",
            "detail": "compiler: cl.exe"
        }
    ]
}
// 配置c_cpp_properties.json  
{
    "configurations": [
        {
            "name": "Win32",
            "includePath": [
                "${workspaceFolder}/**",
                "C:/Program Files (x86)/Microsoft Visual Studio 11.0/VC/include/**",
                "C:/Program Files (x86)/Windows Kits/10/Include/10.0.10150.0/ucrt/**",
                "F:/Download/cproject/sdk/include/**",
            ],
            "defines": [
                "_DEBUG",
                "UNICODE",
                "_UNICODE"
            ],
            "windowsSdkVersion": "8.1",
            "compilerPath": "cl.exe",
            "cStandard": "c17",
            "cppStandard": "c++17",
            "intelliSenseMode": "windows-msvc-x86"
        }
    ],
    "version": 4
}

main.cpp里#include "sdk/include/app/version.h"可以使用
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="c-抛出自定义异常类"><a href="#c-抛出自定义异常类" class="headerlink" title="c++ 抛出自定义异常类"></a>c++ 抛出自定义异常类</h3><p>C++中，你可以通过继承 std::exception 类并重写其中的虚函数 what() 来创建自定义的异常类</p>
<pre class="line-numbers language-html"><code class="language-html">#include <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>iostream</span><span class="token punctuation">></span></span>
#include <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exception</span><span class="token punctuation">></span></span>

// 自定义异常类
class MyException : public std::exception {
public:
    // 构造函数
    MyException(const char* message) : errorMessage(message) {}

    // 重写 what() 函数
    const char* what() const noexcept override {
        return errorMessage.c_str();
    }

private:
    std::string errorMessage;
};

int main() {
    try {
        // 抛出自定义异常类的实例
        throw MyException("自定义异常：发生了错误！");
    }
    catch (const std::exception&amp; e) {
        // 捕获并处理异常
        std::cout &lt;&lt; "捕获到异常：" &lt;&lt; e.what() &lt;&lt; std::endl;
    }

    return 0;
}
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="std-shared-ptr用法"><a href="#std-shared-ptr用法" class="headerlink" title="std::shared_ptr用法"></a>std::shared_ptr用法</h3><pre class="line-numbers language-html"><code class="language-html">#include <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>iostream</span><span class="token punctuation">></span></span>
#include <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>memory</span><span class="token punctuation">></span></span>

class MyClass {
public:
    MyClass() {
        std::cout &lt;&lt; "MyClass 构造函数" &lt;&lt; std::endl;
    }
    ~MyClass() {
        std::cout &lt;&lt; "MyClass 析构函数" &lt;&lt; std::endl;
    }
    void doSomething() {
        std::cout &lt;&lt; "Doing something..." &lt;&lt; std::endl;
    }
};

int main() {
    // 创建一个 shared_ptr，指向 MyClass 对象
    std::shared_ptr<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>MyClass</span><span class="token punctuation">></span></span> mySharedPtr = std::make_shared<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>MyClass</span><span class="token punctuation">></span></span>();
    // 使用 shared_ptr 调用对象的成员函数
    mySharedPtr->doSomething();
    // 在作用域结束前，shared_ptr 会自动释放资源
    return 0;
}

<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="c-多线程的join"><a href="#c-多线程的join" class="headerlink" title="c++多线程的join()"></a>c++多线程的join()</h3><p>当你创建一个线程并希望等待该线程执行完成时，可以使用join()方法。具体来说，join()方法的作用是阻塞当前线程，直到被调用的线程执行完成为止。<br>假设你有一个线程对象myThread，你可以通过调用myThread.join()来等待myThread线程执行完成。在调用join()之后，当前线程会一直等待，直到 myThread 线程执行完毕才会继续执行。</p>
<pre class="line-numbers language-html"><code class="language-html">#include <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>iostream</span><span class="token punctuation">></span></span>
#include <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>thread</span><span class="token punctuation">></span></span>

void threadFunction() {
    // 模拟一些耗时操作
    std::this_thread::sleep_for(std::chrono::seconds(2));
    std::cout &lt;&lt; "Thread function executed" &lt;&lt; std::endl;
}

int main() {
    std::thread myThread(threadFunction); // 创建一个新线程
    // 在这里可以进行一些其他操作

    myThread.join(); // 等待 myThread 线程执行完成

    std::cout &lt;&lt; "Main function continues" &lt;&lt; std::endl;
    return 0;
}
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>需要注意的是，只能对一个线程调用一次join()方法。如果尝试对同一个线程同时调用多次join()方法，或者对已经join()过的线程再次调用join()，都会导致运行时错误。因此，在实际使用中，需要确保对每个线程只调用一次 join()</p>
<h3 id="以十六进制的形式打印每个字节"><a href="#以十六进制的形式打印每个字节" class="headerlink" title="以十六进制的形式打印每个字节"></a>以十六进制的形式打印每个字节</h3><pre class="line-numbers language-html"><code class="language-html">
void showBuf(char* _buf,int length_to_print);

int main(int argc, char *argv[]){
    SBuffer buf;
    str b1 = "abcde";
    buf &lt;&lt; b1;
    showBuf(buf._buf,buf._count);
    return 0;
}

void showBuf(char* _buf,int length_to_print){
    if(length_to_print==0){
        printf("_buf size is zero");
    }else{
        for(int i=0;i&lt;length_to_print;++i){
            // 以十六进制的形式打印每个字节
            printf("%02x ",(unsigned char)_buf[i]);
        }
    }
    printf("\n");
}
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="十六进制形式打印u32变量的字节内容"><a href="#十六进制形式打印u32变量的字节内容" class="headerlink" title="十六进制形式打印u32变量的字节内容"></a>十六进制形式打印u32变量的字节内容</h3><pre class="line-numbers language-html"><code class="language-html">void printBytes(u32 value) {
    uint8_t* ptr = reinterpret_cast<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>uint8_t*</span><span class="token punctuation">></span></span>(&amp;value);
    for (int i = 0; i &lt; sizeof(uint32_t); i++) {
        std::cout &lt;&lt; std::setfill('0') &lt;&lt; std::setw(2) &lt;&lt; std::hex &lt;&lt; static_cast<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>int</span><span class="token punctuation">></span></span>(ptr[i]) &lt;&lt; " ";
    }
    std::cout &lt;&lt; std::endl;
}  
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="通过两字节的十六进制内容-两个u8-初始化u16"><a href="#通过两字节的十六进制内容-两个u8-初始化u16" class="headerlink" title="通过两字节的十六进制内容(两个u8)初始化u16"></a>通过两字节的十六进制内容(两个u8)初始化u16</h3><pre class="line-numbers language-html"><code class="language-html">u16 u16fromHex(const u8* bytes, bool littleEndian) {
    u16 value = 0;
    if (littleEndian) {
        value |= static_cast<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>u16</span><span class="token punctuation">></span></span>(bytes[0]);
        value |= static_cast<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>u16</span><span class="token punctuation">></span></span>(bytes[1]) &lt;&lt; 8;
    } else {
        value |= static_cast<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>u16</span><span class="token punctuation">></span></span>(bytes[1]);
        value |= static_cast<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>u16</span><span class="token punctuation">></span></span>(bytes[0]) &lt;&lt; 8;
    }
    return value;
}

// u8 bytes[]={0xF1,0x12};
// u16 res=u16fromHex(bytes);
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="解析4字节当作整数"><a href="#解析4字节当作整数" class="headerlink" title="解析4字节当作整数"></a>解析4字节当作整数</h3><pre class="line-numbers language-html"><code class="language-html">int length = 4;
unsigned char hexArray[4]={0x0a,0x00,0x00,0x00};
for(int i=0;i&lt;length;++i){
    // 单独打印查看每个字节代表的整数
    std::cout&lt;&lt;static_cast<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>int</span><span class="token punctuation">></span></span>(hexArray[i])&lt;&lt; " "&lt;&lt;std::endl;
}
// 当作4字节的整数
int res = (hexArray[0]&lt;&lt;24)|(hexArray[1]&lt;&lt;16)|(hexArray[2]&lt;&lt;8)|(hexArray[3]); // 高位在前
int res2 = (hexArray[3]&lt;&lt;24)|(hexArray[2]&lt;&lt;16)|(hexArray[1]&lt;&lt;8)|(hexArray[0]); // 低位在前(*)
std::cout&lt;&lt;res&lt;&lt;"  "&lt;&lt;res2&lt;&lt;std::endl;;
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="指定十六进制内容存到指定的指针处"><a href="#指定十六进制内容存到指定的指针处" class="headerlink" title="指定十六进制内容存到指定的指针处"></a>指定十六进制内容存到指定的指针处</h3><pre class="line-numbers language-html"><code class="language-html">// 自定义字节内容的源数据
unsigned char hexArray[]={0x0a,0x0d,0xbe,0xfa,0x66};
int length = sizeof(hexArray)/sizeof(hexArray[0]);
// 目标位置
char* _buf=new char[length];
// 复制过去
memcpy(_buf,hexArray,sizeof(hexArray));
//打印查看
showBuf(_buf,length);
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="序列化和反序列化"><a href="#序列化和反序列化" class="headerlink" title="序列化和反序列化"></a>序列化和反序列化</h3><p>自定义结构体  </p>
<pre class="line-numbers language-html"><code class="language-html">struct iXXXParam{
    int Rps;
    int Freq;
    int Dist;
    SBuffer Reserve;
    iXXXParam():
        Rps(5),
        Freq(30),
        Dist(100),
        Reserve(){}
};
inline SBuffer&amp; operator &lt;&lt; (SBuffer&amp; buf, const iXXXParam&amp; value){
    buf &lt;&lt; value.Rps
        &lt;&lt; value.Freq
        &lt;&lt; value.Dist
        &lt;&lt; value.Reserve;
    return buf;
}
inline SBuffer&amp; operator >> (SBuffer&amp; buf, iXXXParam&amp; value){
    buf >> value.Rps
        >> value.Freq
        >> value.Dist
        >> value.Reserve;
    return buf;
}
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>序列化和反序列化  </p>
<pre class="line-numbers language-html"><code class="language-html">// 序列化
    iXXXParam dat;
    dat.Rps = 1;
    dat.Freq = 2;
    int c0=21;
    str c1="12;32;68;";
    dat.Reserve &lt;&lt; c0;
    dat.Reserve &lt;&lt; c1;

    SBuffer buf;
    buf &lt;&lt; dat;

    showBuf(buf._buf,buf._count);
// 反序列化
    iXXXParam datNew;
    buf >> datNew;

    showBuf(datNew.Reserve._buf,datNew.Reserve._count);
    int cc0=0;
    str cc1="";
    datNew.Reserve >> cc0;
    datNew.Reserve >> cc1;
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="C-中使用多线程处理异步操作并设置超时"><a href="#C-中使用多线程处理异步操作并设置超时" class="headerlink" title="C++中使用多线程处理异步操作并设置超时"></a>C++中使用多线程处理异步操作并设置超时</h3><p>通过启动一个异步操作的线程来模拟异步操作。然后，我们使用一个标志变量isOperationCompleted来表示异步操作是否已完成。我们设置了5秒的超时时间，在等待超时时间内判断异步操作是否完成。如果异步操作在超时时间内完成，我们输出相应的消息；如果超时，我们可以在该部分添加相应的超时处理逻辑</p>
<pre class="line-numbers language-html"><code class="language-html">#include <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>iostream</span><span class="token punctuation">></span></span>
#include <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>thread</span><span class="token punctuation">></span></span>
#include <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>chrono</span><span class="token punctuation">></span></span>

// 异步操作的函数
void asyncOperation()
{
    // 模拟异步操作
    std::this_thread::sleep_for(std::chrono::seconds(3));
    std::cout &lt;&lt; "Async operation completed." &lt;&lt; std::endl;
}

int main()
{
    bool isOperationCompleted = false;
    // 启动异步操作的线程
    std::thread asyncThread([&amp;]() {
        asyncOperation();
        isOperationCompleted = true;
    });
    // 设置超时时间
    std::chrono::seconds timeout(5);
    // 等待异步操作完成或超时
    if (asyncThread.joinable()) {
        if (asyncThread.joinable()) {
            asyncThread.join();
        }
    }
    // 根据操作是否完成进行相应处理
    if (isOperationCompleted) {
        std::cout &lt;&lt; "Async operation completed within the timeout." &lt;&lt; std::endl;
    } else {
        std::cout &lt;&lt; "Async operation timed out." &lt;&lt; std::endl;
        // 可在此处执行超时后的处理逻辑
    }
    return 0;
}
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="多线程对代码块资源上锁"><a href="#多线程对代码块资源上锁" class="headerlink" title="多线程对代码块资源上锁"></a>多线程对代码块资源上锁</h3><p>std::recursive_mutex 是 C++ 标准库中的一个互斥锁类，它允许同一个线程多次获得锁。<br>互斥锁是一种用于保护共享资源的同步原语。当多个线程需要同时访问某个共享资源时，你可以使用互斥锁来确保只有一个线程能够访问该资源，其他线程需要等待。<br>与std::mutex类型相比，std::recursive_mutex类型允许同一个线程在持有锁的情况下再次获得锁，而不会发生死锁。这对于递归调用或嵌套函数调用中需要对共享资源进行保护的情况非常有用。  </p>
<pre class="line-numbers language-html"><code class="language-html">#include <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>iostream</span><span class="token punctuation">></span></span>
#include <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>thread</span><span class="token punctuation">></span></span>
#include <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mutex</span><span class="token punctuation">></span></span>

std::recursive_mutex mtx;

void recursiveFunction(int depth) {
    std::lock_guard<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">std:</span>:recursive_mutex</span><span class="token punctuation">></span></span> lock(mtx);
    std::cout &lt;&lt; "Depth: " &lt;&lt; depth &lt;&lt; std::endl;

    if (depth > 0) {
        recursiveFunction(depth - 1);
    }
}

int main() {
    std::thread t(recursiveFunction, 3);
    t.join();

    return 0;
}
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="std-recursive-mutex的作用域和解锁时机"><a href="#std-recursive-mutex的作用域和解锁时机" class="headerlink" title="std::recursive_mutex的作用域和解锁时机"></a>std::recursive_mutex的作用域和解锁时机</h3><p>当线程进入一个被 std::recursive_mutex 保护的代码块时，可以使用 std::lock_guard 或 std::unique_lock 来自动获取锁，并在退出该代码块时自动释放锁。这种自动锁定和解锁的方式可以确保在任何情况下都能正确地管理互斥锁，避免忘记解锁导致的死锁  </p>
<pre class="line-numbers language-html"><code class="language-html">#include <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>iostream</span><span class="token punctuation">></span></span>
#include <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>thread</span><span class="token punctuation">></span></span>
#include <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mutex</span><span class="token punctuation">></span></span>

std::recursive_mutex mtx;

void functionA() {
    std::lock_guard<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">std:</span>:recursive_mutex</span><span class="token punctuation">></span></span> lock(mtx);
    // 处理函数A的逻辑
}  // 在此处自动释放锁

void functionB() {
    std::lock_guard<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">std:</span>:recursive_mutex</span><span class="token punctuation">></span></span> lock(mtx);
    // 处理函数B的逻辑
    functionA();  // 函数A也可以获取和释放锁
}  // 在此处自动释放锁

int main() {
    std::lock_guard<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">std:</span>:recursive_mutex</span><span class="token punctuation">></span></span> lock(mtx);
    // 处理主函数的逻辑
    functionB();  // 函数B也可以获取和释放锁

    return 0;
}  // 在此处自动释放锁
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="RPC收发包时进行分割重组"><a href="#RPC收发包时进行分割重组" class="headerlink" title="RPC收发包时进行分割重组"></a>RPC收发包时进行分割重组</h3><p>C++中进行远程过程调用（RPC）时，如果需要发送的数据包过大，可以将数据包分割成小包进行发送<br>这通常涉及到以下步骤：  </p>
<ol>
<li><p>确定包的大小限制：在设计RPC协议时，需要确定单个数据包的最大允许大小。这可以根据网络传输的限制和系统性能来决定。</p>
</li>
<li><p>数据包分割：一旦确定了最大包大小，就可以将较大的数据包分割成小包。你可以创建一个数据结构来表示每个小包，并在发送端对大包进行拆分，将拆分后的小包依次发送；在接收端则需要能够识别并组装这些小包。</p>
</li>
<li><p>发送和接收逻辑：发送端需要负责按照顺序发送小包，并在接收端对接收到的小包进行排序和组装，以恢复原始的大包数据。这可能需要在通信协议中添加一些元数据，以便接收端能够正确地重构原始的数据包。</p>
</li>
<li><p>处理丢包和重发：由于网络条件不稳定，可能会有小包丢失。因此，在接收端需要实现对丢失的小包进行重发请求，确保所有的小包都能够被正确接收和组装。  </p>
</li>
</ol>
<p>下面是一个简单的伪代码示例，演示了如何在C++中进行RPC时对数据包进行分割和重组  </p>
<pre class="line-numbers language-html"><code class="language-html">// 发送端代码
void sendLargePacket(const std::vector<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>char</span><span class="token punctuation">></span></span>&amp; largeData, int maxPacketSize, RemoteConnection conn) {
    int numPackets = (largeData.size() + maxPacketSize - 1) / maxPacketSize;  // 计算分割后的小包数量
    for (int i = 0; i &lt; numPackets; ++i) {
        int start = i * maxPacketSize;
        int end = std::min((i + 1) * maxPacketSize, static_cast<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>int</span><span class="token punctuation">></span></span>(largeData.size()));
        std::vector<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>char</span><span class="token punctuation">></span></span> smallPacket(largeData.begin() + start, largeData.begin() + end);
        conn.sendPacket(smallPacket);  // 发送小包
    }
}

// 接收端代码
std::vector<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>char</span><span class="token punctuation">></span></span> receiveLargePacket(RemoteConnection conn) {
    std::vector&lt;std::vector<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>char</span><span class="token punctuation">></span></span>> receivedPackets;
    while (true) {
        std::vector<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>char</span><span class="token punctuation">></span></span> packet = conn.receivePacket();  // 接收小包
        receivedPackets.push_back(packet);
        if (packetIsLast(packet)) {
            break;  // 如果是最后一个小包，停止接收
        }
    }
    return assemblePackets(receivedPackets);  // 将小包组装成大包
}

<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>需要注意的是，上述代码只是一个简单的示例，实际情况中可能需要考虑更多的细节，例如丢包处理、超时重发机制等  </p>
<h3 id="C语言文件读写"><a href="#C语言文件读写" class="headerlink" title="C语言文件读写"></a>C语言文件读写</h3><p>fopen函数用于打开文件，并返回一个指向文件的指针。fopen函数有不同的模式参数，可以实现不同的文件操作。<br>读写模式 (“r+”): 使用该模式打开文件时，文件被视为可读可写的。你可以使用fread和fwrite函数来读取和写入文件内容。<br>二进制读写模式 (“rb+”): 使用该模式打开文件时，文件被视为二进制文件且可读可写。与普通的读写模式相比，二进制模式不会对文件内容进行任何转换。这意味着它可以用于处理任意类型的数据，包括文本和非文本数据。你可以使用fread和fwrite函数来读取和写入二进制数据。</p>
<p>在读写模式下，文件会被当作文本文件处理，因此会根据系统的文本处理规则进行换行符转换（例如，Windows系统中的\r\n会被转换为\n）。而在二进制读写模式下，文件被视为二进制文件，不会进行任何转换。  </p>
<p>二进制读写模式更适合处理二进制数据，如图像、音频或视频文件等。而读写模式更适合处理文本文件。  </p>
<p>在使用fopen函数打开文件后，一定要记得使用fclose函数关闭文件，以防止资源泄漏  </p>
<blockquote>
<p>打开文件<br>FILE *fopen(const char *filename, const char *mode);<br>filename是要打开的文件名，可以是绝对路径或相对路径；mode是打开文件的模式<br>r读模式 w写模式 a追加模式 rb二进制读模式 wb二进制写模式 ab二进制追加模式<br>r+可读可写 rb+二进制可读可写<br>使用fread和fwrite函数来读取和写入二进制数据<br>读文件原型size_t fread(void *ptr, size_t size, size_t count, FILE *stream);<br>其中ptr是指向数据缓冲区的指针；size是每个数据项的大小；count是要读取的数据项的数量；stream是文件指针。<br>例如，要读取5个整数到一个整型数组中，可以使用以下代码：<br>int arr[5];<br>fread(arr, sizeof(int), 5, fp);<br>这里arr指向整型数组的指针，sizeof(int)表示每个整数的大小，5表示要读取的整数数量，fp是文件指针<br>写文件原型size_t fwrite(const void *ptr, size_t size, size_t count, FILE *stream);<br>其中ptr是指向要写入的数据的指针；size是每个数据项的大小；count是要写入的数据项的数量；stream是文件指针。<br>例如，要向文件中写入5个整数，可以使用以下代码：<br>int arr[5] = {1, 2, 3, 4, 5};<br>fwrite(arr, sizeof(int), 5, fp);<br>这里arr是整型数组的指针，sizeof(int)表示每个整数的大小，5表示要写入的整数数量，fp是文件指针<br>关闭文件int fclose(FILE *stream);其中stream是文件指针  </p>
</blockquote>
<pre class="line-numbers language-html"><code class="language-html">#include <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>iostream</span><span class="token punctuation">></span></span>
#include <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>io.h</span><span class="token punctuation">></span></span>

using namespace std;

void CreateFile(const char *fileUrl,char* arr,long arrSize){
    // 创建任意二进制内容给文件
//    unsigned char hexA[] = {0xAA, 0xBB, 0xCC, 0xDD, 0xEE, 0xFF};
//    int hexArrayLength = sizeof(hexA) / sizeof(hexA[0]);
//    for (int i = 0; i &lt; hexArrayLength; i++) {
//        printf("%02X ", hexA[i]);
//    }
//    printf("\n");
    FILE* fp;
    fp=fopen(fileUrl,"wb+");
    if (fp == NULL) {
      printf("Error opening file.\n");
      return;
    }
    fwrite(arr, sizeof(char), arrSize, fp);
    fclose(fp);
}

void DeleteContent(const char *fileUrl,long pos,long delSize){
    // 欲从字节偏移量position处开始删除del个字节内容
    long position = pos;
    long del = delSize;
    FILE* fp;
    fp=fopen(fileUrl,"rb+");
    if (fp == NULL) {
        printf("Failed to open file.\n");
        return;
    }
    long fileSize;
    fseek(fp, 0, SEEK_END);
    fileSize = ftell(fp);
    long bufferSize = fileSize-position;// 缓冲区大小
    fseek(fp, position, SEEK_SET);
    char *buffer = (char *)malloc(bufferSize);
    // 读取插入偏移位置之后的原始数据到缓冲区里暂存
    size_t bytesRead = fread(buffer, sizeof(char), bufferSize, fp);
    // 文件指针指向新数据插入位置的字节偏移量
    fseek(fp, position, SEEK_SET);
    // 将缓冲区的数据跳过欲删除的字节内容后写回文件
    fwrite(buffer+del, sizeof(char), bufferSize-del, fp);
    // 删除字节内容后文件大小应改变，对文件大小进行截取
    _chsize_s(fileno(fp), fileSize-del);
    free(buffer);
    fclose(fp);
}

void CoverWrite(const char *fileUrl, char* arr,long pos,long arrSize){
    //    // 指定位置覆盖写入数据成功  CoverWrite
        FILE *file = fopen(fileUrl, "rb+");
        if (file == NULL) {
            printf("Failed to open file.\n");
            return;
        }
        // 将新数据写入文件
        //    char newAA[]="hello";
        //    fwrite(newAA, sizeof(char),sizeof(newAA), file);
        //    unsigned char hexArray[] = {0xAA, 0xBB, 0xCC, 0xDD, 0xEE, 0xFF};
        //    fwrite(hexArray, sizeof(char), sizeof(hexArray), file);
        //    int newData = 99;
        //    fwrite(&amp;newData, sizeof(int), 1, file);
        fseek(file, pos, SEEK_SET);
        fwrite(arr, sizeof(char),arrSize, file);
        fclose(file);
        printf("data cover success\n");
}

void InsertWrite(const char *fileUrl,char* arr,long pos,long arrSize){
    //    // 指定位置（字节偏移量position）插入数据成功， InsertWrite
    FILE* fp;
    fp=fopen(fileUrl,"rb+");
    if (fp == NULL) {
        printf("Failed to open file.\n");
        return;
    }
    long fileSize;
    fseek(fp, 0, SEEK_END);
    fileSize = ftell(fp);
    // 插入位置的字节偏移量
    long position = pos;
    long bufferSize = fileSize-position;// 缓冲区大小
    fseek(fp, position, SEEK_SET);
    char *buffer = (char *)malloc(bufferSize);
    // 读取插入偏移位置之后的原始数据到缓冲区里暂存
    size_t bytesRead = fread(buffer, sizeof(char), bufferSize, fp);
    // 文件指针指向新数据插入位置的字节偏移量
    fseek(fp, position, SEEK_SET);
    // 插入新数据
//    char newData[] = "This";
//    size_t newDataSize = strlen(newData);
    fwrite(arr, sizeof(char), arrSize, fp);
    // 将之前缓冲区的数据写回文件
    fwrite(buffer, sizeof(char), bytesRead, fp);
    free(buffer);
    fclose(fp);
}


int main(int argc, char *argv[])
{
//    char hexArr[] = {0xAA, 0xBB, 0xCC, 0xDD, 0xEE, 0xFF};
//    long hexArrayLength = sizeof(hexArr) / sizeof(hexArr[0]);
//    CreateFile("example.bin",hexArr,hexArrayLength);

//    DeleteContent("example.bin",0,2);

//    char newAA[]="AAA";
//    unsigned char hexArray[] = {0xa1, 0xa2, 0xa3};
//    CoverWrite("example.bin",(char*)hexArray,0,3);
//    CoverWrite("example.bin",newAA,4,3);

//    char hexArr[] = {0xEE, 0xFF};
//    InsertWrite("example.bin",hexArr,2,sizeof(hexArr));

    cout &lt;&lt; "Hello World!" &lt;&lt; endl;
    return 0;
}

<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="float变量与char-互转"><a href="#float变量与char-互转" class="headerlink" title="float变量与char[]互转"></a>float变量与char[]互转</h3><p>为避免补码不好阅读，建议转unsigned char[]  </p>
<pre class="line-numbers language-html"><code class="language-html">#include <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>iostream</span><span class="token punctuation">></span></span>
#include <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>iomanip</span><span class="token punctuation">></span></span>
#include <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>cstring</span><span class="token punctuation">></span></span>
using namespace std;
// float &lt;=> unsigned char[]
void printCharArrayInHex(const char* charArray, int size) {
    for (int i = 0; i &lt; size; ++i) {
        //将char型的变量强制转换为无符号char型,避免补码形式
        std::cout &lt;&lt; std::hex &lt;&lt; std::setw(2) &lt;&lt; std::setfill('0') &lt;&lt; static_cast<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>unsigned</span> <span class="token attr-name">int</span><span class="token punctuation">></span></span>(static_cast<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>unsigned</span> <span class="token attr-name">char</span><span class="token punctuation">></span></span>(charArray[i])) &lt;&lt; " ";
    }
    std::cout &lt;&lt; std::endl;
}

int main(int argc, char *argv[])
{
//    char bytes[] = {0x00, 0x00, 0x34, 0x42}; //45 float
//    char bytes[] = {0x00, 0x00, 0xF4, 0x41}; //30.5
//    char bytes[] = {0x33, 0x33, 0xE3, 0x41}; // 28.4
//    char bytes[] = {0xCD, 0xCC, 0xAC, 0x41}; // 21.6
//    char bytes[] = {0x00, 0x00, 0x00, 0x3F}; // 0.5
//    char bytes[] = {0x66, 0xA6, 0xCA, 0x42};   // 101.325
     char bytes[] = {0xc3, 0xF5, 0x48, 0x40}; // 3.14
    float floatValue;
    memcpy(&amp;floatValue, bytes, sizeof(float));
    cout &lt;&lt; floatValue &lt;&lt; endl;

    float fValue = 3.14f;
    char charArray[sizeof(float)];
    memcpy(charArray, &amp;fValue, sizeof(float));
    printCharArrayInHex(charArray,sizeof(float));

    return 0;
}

<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="int计算溢出"><a href="#int计算溢出" class="headerlink" title="int计算溢出"></a>int计算溢出</h3><pre class="line-numbers language-html"><code class="language-html">int64_t x = 20*1024*1024*1024 会溢出，20*1024*1024*1024时超出int能表达的最大值了
int64_t x = (int64_t)(20)*1024*1024*1024 不会溢出
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<h3 id="C-11-自定义线程池"><a href="#C-11-自定义线程池" class="headerlink" title="C++11 自定义线程池"></a>C++11 自定义线程池</h3><p>实现了一个简单的任务队列，使用条件变量来实现任务的等待和唤醒。当线程池被销毁时，它会等待所有正在执行的任务完成后再退出。你可以调用enqueue方法向线程池中添加任务，这个函数会返回一个std::future对象，你可以通过它来访问任务的结果。</p>
<pre class="line-numbers language-html"><code class="language-html">#include <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>iostream</span><span class="token punctuation">></span></span>
#include <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>vector</span><span class="token punctuation">></span></span>
#include <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>queue</span><span class="token punctuation">></span></span>
#include <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>thread</span><span class="token punctuation">></span></span>
#include <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mutex</span><span class="token punctuation">></span></span>
#include <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>condition_variable</span><span class="token punctuation">></span></span>

class ThreadPool {
public:
    ThreadPool(size_t numThreads) : stop(false) {
        for (size_t i = 0; i &lt; numThreads; ++i) {
            workers.emplace_back(
                [this] {
                    for (;;) {
                        std::function<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>void()</span><span class="token punctuation">></span></span> task;

                        {
                            std::unique_lock<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">std:</span>:mutex</span><span class="token punctuation">></span></span> lock(this->queue_mutex);
                            this->condition.wait(lock,
                                [this] { return this->stop || !this->tasks.empty(); });
                            if (this->stop &amp;&amp; this->tasks.empty()) return;
                            task = std::move(this->tasks.front());
                            this->tasks.pop();
                        }

                        task();
                    }
                }
            );
        }
    }

    template<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>class</span> <span class="token attr-name">F</span><span class="token punctuation">></span></span>
    void enqueue(F&amp;&amp; f) {
        {
            std::unique_lock<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">std:</span>:mutex</span><span class="token punctuation">></span></span> lock(queue_mutex);

            // don't allow enqueueing after stopping the pool
            if (stop)
                throw std::runtime_error("enqueue on stopped ThreadPool");

            tasks.emplace(std::forward<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>F</span><span class="token punctuation">></span></span>(f));
        }
        condition.notify_one();
    }

    ~ThreadPool() {
        {
            std::unique_lock<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">std:</span>:mutex</span><span class="token punctuation">></span></span> lock(queue_mutex);
            stop = true;
        }
        condition.notify_all();
        for (std::thread&amp; worker : workers)
            worker.join();
    }

private:
    std::vector<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">std:</span>:thread</span><span class="token punctuation">></span></span> workers;
    std::queue&lt;std::function<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>void()</span><span class="token punctuation">></span></span>> tasks;

    std::mutex queue_mutex;
    std::condition_variable condition;
    bool stop;
};

// 使用示例
int main() {
    ThreadPool pool(4);

    std::vector&lt;std::future<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>int</span><span class="token punctuation">></span></span>> results;

    for (int i = 0; i &lt; 8; ++i) {
        results.emplace_back(
            pool.enqueue([i] {
                std::cout &lt;&lt; "hello " &lt;&lt; i &lt;&lt; std::endl;
                std::this_thread::sleep_for(std::chrono::seconds(1));
                std::cout &lt;&lt; "world " &lt;&lt; i &lt;&lt; std::endl;
                return i * i;
            })
        );
    }

    for (auto&amp;&amp; result : results)
        std::cout &lt;&lt; result.get() &lt;&lt; ' ';
    std::cout &lt;&lt; std::endl;

    return 0;
}

<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="其它"><a href="#其它" class="headerlink" title="其它"></a>其它</h2><h3 id="char-和std-string相互转换"><a href="#char-和std-string相互转换" class="headerlink" title="char*和std::string相互转换"></a>char*和std::string相互转换</h3><p>char*是C的类型，std::string是C++的类型  </p>
<pre class="line-numbers language-html"><code class="language-html">const char* convertStringToCharPointer(const std::string&amp; str) {
    return str.c_str();
    // return str.data();
}
std::string convertCharPointerToString(const char* str) {
    return std::string(str);
}
另外，将 char* 转换为 std::string 时需要保证前者以 '\0' 结尾。
转换 char* 数据时最好检测一下它是否为 NULL：str == NULL  
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="获取当前日期时间"><a href="#获取当前日期时间" class="headerlink" title="获取当前日期时间"></a>获取当前日期时间</h3><pre class="line-numbers language-html"><code class="language-html">#include <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ctime</span><span class="token punctuation">></span></span>  

std::string getNowTime(){
    std::time_t currentTime = std::time(nullptr);
    std::tm* localTime =std::localtime(&amp;currentTime);
    char formattedDateTime[100];
    std::strftime(formattedDateTime,sizeof(formattedDateTime),"%Y-%m-%d %H:%M:%S",localTime);
    return std::string(formattedDateTime);
}
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="window通过SMB共享文件"><a href="#window通过SMB共享文件" class="headerlink" title="window通过SMB共享文件"></a>window通过SMB共享文件</h2><p>通过Windows资源管理器进入工控机目录获取文件时，默认情况下使用的是SMB（Server Message Block）协议  </p>
<p>SMB是一种客户端-服务器协议，用于在计算机之间共享文件、打印机和其它资源。在局域网内，Windows系统支持使用SMB协议来访问共享文件夹，因此用户可以通过Windows资源管理器等工具，在网络中浏览、查看和拷贝文件。</p>
<pre class="line-numbers language-html"><code class="language-html">1  先设置文件夹共享，目标文件夹右键属性->共享->高级共享->共享此文件夹打勾，起名smbshare,权限Everyone完全控制,点击确定后可以看到属性->共享 出现网络路径“\\DESKTOP-VQXXX\\smbshare”
2  然后最好在目标文件夹右键属性->共享-> 点击"共享(s)..."->选中 添加Everyone 所有者 用户->点击"共享(H)"确认
3  关闭防火墙
4  进入cmd执行ipconfig 查询IP地址
5  进入cmd执行net share 查询共享信息，可以查看到刚才新建的共享名smbshare
6  进入资源管理器，在顶部"此电脑"或"我的电脑"右键，选择"映射网络驱动器"。
7  在弹出的对话框中，选择一个可用的驱动器字母（例如Z、X等），这将成为你访问共享文件的本地驱动器符号。
8  还是上面的对话框，“文件夹”填写共享路径，形如"\\192.168.0.140\smbshare"，其中smbshare为刚才新建的共享名
9  点击"完成"即可
10 运行或资源管理器地址里通过"\\192.168.0.140\smbshare"访问操作共享的目标文件夹

浏览器不可访问 "\\192.168.0.140\smbshare\" 这样的目录
但浏览器可以这样访问文件"file://192.168.157.140/smbshare/335566.txt"，

以上访问共享需要
控制面板——网络和共享中心——更改高级共享设置-- 关闭密码保护共享
可以无密码访问共享目录
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="MSVC2010-32bit编译CURL-使用不需要重新编译"><a href="#MSVC2010-32bit编译CURL-使用不需要重新编译" class="headerlink" title="MSVC2010_32bit编译CURL(使用不需要重新编译)"></a>MSVC2010_32bit编译CURL(使用不需要重新编译)</h2><pre class="line-numbers language-html"><code class="language-html">https://curl.se/download.html 下载源码 http://curl.haxx.se/download/curl-7.32.0.zip  

打开curl-7.32.0\vs\vc8\lib\vc8libcurl.vcproj文件，VS会提示升级工程，下一步下一步即可  

打开工程属性 > C\C++ > 常规 > 附加包含目录。这里的包含目录是"..\include"，而这个目录根本就不存在，它应该指向"curl-7.32.0\include"才对，所以把这里改成"..\..\..\include"

打开工程属性>C\C++>预处理器>预处理器定义。这里有个默认宏"BUILDING_LIBCURL"，把它改成"CURL_STATICLIB"。这样，那些接口函数就不会被声明为导出函数  

打开工程属性 > 库管理器 > 常规 > 附加依赖项。添加ws2_32.lib和wldap32.lib，这是CURL必须依赖的。

Release Win32 编译即可得到libcurl.lib。  

整理目录
curl-7.32.0\include下放源文件curl-7.32.0\include下的curl目录
curl-7.32.0\lib下放刚编译得到的libcurl.lib
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="Qt5-5MSVC2010-32bit使用libcurl"><a href="#Qt5-5MSVC2010-32bit使用libcurl" class="headerlink" title="Qt5.5MSVC2010_32bit使用libcurl"></a>Qt5.5MSVC2010_32bit使用libcurl</h2><p>不用重新编译源码，直接在官网(<a href="https://curl.se/download.html)下载windows的安装包curl-8.5.0_5-win32-mingw.zip或者curl-8.5.0_5-win64-mingw.zip解压得到bin_lib_include" target="_blank" rel="noopener">https://curl.se/download.html)下载windows的安装包curl-8.5.0_5-win32-mingw.zip或者curl-8.5.0_5-win64-mingw.zip解压得到bin_lib_include</a>  </p>
<p>下面示例包含3个功能，(同步下载，目前支持http://和局域网内file:// ,其它协议没有尝试)<br>获取远程小文件内容在内存里识别<br>下载文件带进度跟踪<br>获取远程文件大小</p>
<pre class="line-numbers language-html"><code class="language-html">指定静态库位置，接着指定include路径。  
然后把curl路径的bin目录中的dll拷贝到debug|release文件夹。否则run的时候会“莫名其妙”的停止。

//*.pro:
INCLUDEPATH += E:/Download/curl_8.5.0_5_win32_mingw/include
LIBS += E:/Download/curl_8.5.0_5_win32_mingw/lib/lib*.a

// main.cpp 访问内容放在内存中识别
#include <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>iostream</span><span class="token punctuation">></span></span>

#include &lt;curl/curl.h>
#include &lt;curl/easy.h>

#include <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>fstream</span><span class="token punctuation">></span></span>
#include <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>string</span><span class="token punctuation">></span></span>
#include <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>iomanip</span><span class="token punctuation">></span></span>

using namespace std;

// 下载文件的回调函数，用于写入下载的数据
size_t write_data(void *ptr, size_t size, size_t nmemb, FILE *stream) {
    size_t written;
    written = fwrite(ptr, size, nmemb, stream);
    if(written &lt;=0){
        printf("nothing written!!");
    }
    return written;
}
// 下载文件进度的回调函数
int my_progress_func(char *progress_data,double dltotal, double dlnow, double ultotal,double ulnow)
{
    if ((int)(dlnow*100.0 / dltotal) % 5 == 0)
    {
//        printf("%s %g / %g (%g %%)\n", progress_data, dlnow, dltotal, dlnow*100.0 / dltotal);
        printf("%g / %g (%g %%)\n",  dlnow, dltotal, dlnow*100.0 / dltotal);
    }
    return 0;
}

// 下载文件 不支持https,  测试可以下载 (局域网内共享文件)file://和http:// 小文件
int DOWNLOAD_FILE(const char* url, const char outfilename[FILENAME_MAX]){
    // url = "" , outfilename = "";
    CURL *curl;
    FILE *fp;
    CURLcode res;
    /*   调用curl_global_init()初始化libcurl  */
    res = curl_global_init(CURL_GLOBAL_ALL);
    if (CURLE_OK != res)
    {
        printf("init libcurl failed.");
        curl_global_cleanup();
        return -1;
    }
    /*  调用curl_easy_init()函数得到 easy interface型指针  */
    curl = curl_easy_init();
    if (curl) {

        fopen_s(&amp;fp,outfilename,"wb");

        /*  调用curl_easy_setopt()设置传输选项 */
        res = curl_easy_setopt(curl, CURLOPT_URL, url);
        if (res != CURLE_OK)
        {
            fclose(fp);
            curl_easy_cleanup(curl);
            return -1;
        }
        /*  根据curl_easy_setopt()设置的传输选项，实现回调函数以完成用户特定任务  */
        res = curl_easy_setopt(curl, CURLOPT_WRITEFUNCTION, write_data);
        if (res != CURLE_OK)
        {
            fclose(fp);
            curl_easy_cleanup(curl);
            return -1;
        }
        /*  根据curl_easy_setopt()设置的传输选项，实现回调函数以完成用户特定任务  */
        res = curl_easy_setopt(curl, CURLOPT_WRITEDATA, fp);
        if (res != CURLE_OK)
        {
            fclose(fp);
            curl_easy_cleanup(curl);
            return -1;
        }
        // 根据curl_easy_setopt()设置的传输选项，添加下载进度功能
        res = curl_easy_setopt(curl, CURLOPT_NOPROGRESS,0L);
        if(res !=CURLE_OK){
            fclose(fp);
            curl_easy_cleanup(curl);
            return -1;
        }
        // 根据curl_easy_setopt()设置的传输选项，添加下载进度函数
        res = curl_easy_setopt(curl, CURLOPT_PROGRESSFUNCTION,my_progress_func);
        if(res !=CURLE_OK){
            fclose(fp);
            curl_easy_cleanup(curl);
            return -1;
        }
        // 根据curl_easy_setopt()设置的传输选项，添加下载进度对象
        res = curl_easy_setopt(curl, CURLOPT_PROGRESSDATA,curl);
        if(res !=CURLE_OK){
            fclose(fp);
            curl_easy_cleanup(curl);
            return -1;
        }

        // 调用curl_easy_perform()函数完成传输任务
        res = curl_easy_perform(curl);
        fclose(fp);
        /* Check for errors */
        if(res != CURLE_OK){
            fprintf(stderr, "curl_easy_perform() failed: %s\n",curl_easy_strerror(res));
            curl_easy_cleanup(curl);
            return -1;
        }else{
            printf("download complete success.\n");
        }

        /* always cleanup */
        // 调用curl_easy_cleanup()释放内存
        curl_easy_cleanup(curl);                                     

    }
    curl_global_cleanup();
    return 0;
}

// 访问网络文件内容到缓存里看结果
size_t WriteCallback(void* contents, size_t size, size_t nmemb, std::string* buffer)
{
    size_t totalSize = size * nmemb;
    buffer->append((char*)contents, totalSize);
    return totalSize;
}
// 获取目标文件大小
size_t get_size_struct(void* ptr, size_t size, size_t nmemb, void* data) {
    return (size_t)(size * nmemb);
}
double GetRemoteFileSize2(const char* url) {
// 通过HTTP的HEAD方式来获取的，但是并不是所有HTTP的服务器都是支持HEAD方式来获取
//    url="file://192.168.157.134/smbshare2/curl-8.5.0_5-win64-mingw.zip";

    CURL* curl;
    CURLcode res;
    double size = 0.0;

    curl = curl_easy_init();
    curl_easy_setopt(curl, CURLOPT_URL, url);
    curl_easy_setopt(curl, CURLOPT_NOBODY, 1L);
    curl_easy_setopt(curl, CURLOPT_HEADERFUNCTION, get_size_struct);
    curl_easy_setopt(curl, CURLOPT_FOLLOWLOCATION, 1L);

    res = curl_easy_perform(curl);
    res = curl_easy_getinfo(curl, CURLINFO_CONTENT_LENGTH_DOWNLOAD, &amp;size);
    if (res != CURLE_OK) {
        fprintf(stderr, "curl_easy_getinfo() failed: %s\n", curl_easy_strerror(res));
    }
    curl_easy_cleanup(curl);

    std::cout &lt;&lt; "Size in KB: " &lt;&lt; (size / 1024 ) &lt;&lt;" (KB)"&lt;&lt; std::endl;
    std::cout &lt;&lt; "Size in MB: " &lt;&lt; (size / (1024 * 1024)) &lt;&lt;" (MB)"&lt;&lt; std::endl;
    std::cout &lt;&lt; "Size in GB: " &lt;&lt; (size / (1024 * 1024 * 1024)) &lt;&lt;" (GB)"&lt;&lt; std::endl;

    return size;
}

double GetRemoteFileSize(const char* url) {
    // 这种GET方式解决获取文件长度，而不下载文件内容
//    url="file://192.168.157.134/smbshare2/curl-8.5.0_5-win64-mingw.zip";

    CURL* curl;
    CURLcode res;
    double size = 0.0;

    curl = curl_easy_init();
    curl_easy_setopt(curl, CURLOPT_URL, url);
    curl_easy_setopt(curl, CURLOPT_NOBODY, 1L); //不需求body
    curl_easy_setopt(curl, CURLOPT_CUSTOMREQUEST, "GET");    //使用CURLOPT_CUSTOMREQUEST

    if(curl_easy_perform(curl)==CURLE_OK){
        curl_easy_getinfo(curl, CURLINFO_CONTENT_LENGTH_DOWNLOAD, &amp;size);
        std::cout &lt;&lt; "Size in KB: " &lt;&lt; (size / 1024 ) &lt;&lt;" (KB)"&lt;&lt; std::endl;
        std::cout &lt;&lt; "Size in MB: " &lt;&lt; (size / (1024 * 1024)) &lt;&lt;" (MB)"&lt;&lt; std::endl;
        std::cout &lt;&lt; "Size in GB: " &lt;&lt; (size / (1024 * 1024 * 1024)) &lt;&lt;" (GB)"&lt;&lt; std::endl;
    }else{
        size=-1;
        std::cout &lt;&lt; "GetRemoteFileSize failed"&lt;&lt; std::endl;
    }
    curl_easy_cleanup(curl);

    return size;
}


void GetRemoteContentInCache(std::string url){
    // 访问网络文件内容到缓存里看结果
    CURL* curl;
    CURLcode res;
//    std::string url = "file://192.168.157.134/smbshare2/999.txt";
    std::string buffer;

    curl_global_init(CURL_GLOBAL_DEFAULT);

    curl = curl_easy_init();
    if (curl)
    {
        curl_easy_setopt(curl, CURLOPT_URL, url.c_str());
        curl_easy_setopt(curl, CURLOPT_WRITEFUNCTION, WriteCallback);
        curl_easy_setopt(curl, CURLOPT_WRITEDATA, &amp;buffer);

        res = curl_easy_perform(curl);
        if (res != CURLE_OK)
        {
            std::cout &lt;&lt; "Failed to download file: " &lt;&lt; curl_easy_strerror(res) &lt;&lt; std::endl;
        }

        curl_easy_cleanup(curl);
    }

    curl_global_cleanup();

    if (!buffer.empty())
    {
        std::cout &lt;&lt; "Remote File content:\n" &lt;&lt; buffer.c_str() &lt;&lt; std::endl;
    }
}
void DownLoadFile(std::string targetUrl,std::string savePath){
    // 简单下载文件
//    std::string url0 = "http://www.zhdgps.com/images/ln23p.png";
//    std::string url1 = "file://192.168.157.134/smbshare2/curl-8.5.0_5-win64-mingw.zip";
//    std::string savepath = "./my.zip";
//        savePath = "./../xyz.zip";
//    savePath="E:/Project/mymy.zip";

    DOWNLOAD_FILE(targetUrl.c_str(),savePath.c_str());

}


int main(int argc, char* argv[])
{
    if(argc &lt; 2){
        std::cout &lt;&lt; "Please provide an argument." &lt;&lt; std::endl;
        return 1;
    }
    std::string argument = argv[1];
    if(argument == "DownLoadFile"){
//        DownLoadFile("file://192.168.157.134/smbshare2/curl-8.5.0_5-win64-mingw.zip","./my.zip");
        DownLoadFile("file://192.168.157.134/smbshare2/xxx.rar","./my.zip");
    }else if(argument == "GetRemoteFileSize"){
        GetRemoteFileSize("file://192.168.157.134/smbshare2/curl-8.5.0_5-win64-mingw1.zip");
    }else if(argument == "GetRemoteContentInCache"){
        GetRemoteContentInCache("file://192.168.157.134/smbshare2/999.txt");
    }else {
        std::cout &lt;&lt; "Invalid argument." &lt;&lt; std::endl;
    }

    cout &lt;&lt; "success over!" &lt;&lt; endl;
    return 0;

}
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="window下libcurl多线程下载大文件"><a href="#window下libcurl多线程下载大文件" class="headerlink" title="window下libcurl多线程下载大文件"></a>window下libcurl多线程下载大文件</h3><p>首先获取文件总大小。然后创建多个线程，并将文件下载范围分配给每个线程。接下来使用downloadRange() 函数下载每个线程的数据，并使用 XFERINFODATA 选项记录每个线程的下载速度。最后，等待所有线程完成下载并关闭文件指针和 CURL 句柄。通过以上步骤，实现了使用 libcurl 进行多线程下载几百 GB 大小的文件。你可以根据需要调整线程数量和其他参数，以达到最佳性能  </p>
<pre class="line-numbers language-html"><code class="language-html">//*.pro
CONFIG += c++11
INCLUDEPATH += E:/download/curl_8.5.0_win64/include
LIBS += E:/download/curl_8.5.0_win64/lib/lib*.a  

// main.cpp  
#include <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>iostream</span><span class="token punctuation">></span></span>

#include &lt;curl/curl.h>
#include &lt;curl/easy.h>

#include <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>fstream</span><span class="token punctuation">></span></span>
#include <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>string</span><span class="token punctuation">></span></span>
#include <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>iomanip</span><span class="token punctuation">></span></span>

#include <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>vector</span><span class="token punctuation">></span></span>
#include <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>thread</span><span class="token punctuation">></span></span>
#include <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>windows.h</span><span class="token punctuation">></span></span>

using namespace std;

// 定义每个下载线程的状态
struct ThreadState {
    int threadId;               // 线程 ID
    long long startByte;        // 起始字节
    long long endByte;          // 结束字节
    int isFinished;             // 是否完成
    FILE* fp;                   // 文件指针
    CURL* curlHandle;           // CURL 句柄
    double speed;               // 下载速度
};

// 用于记录所有线程的状态
std::vector<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ThreadState</span><span class="token punctuation">></span></span> threadStates;

// 计算文件总大小
long long getFileSize(const std::string&amp; url) {
    CURL* curl = curl_easy_init();
    if (!curl) {
        std::cerr &lt;&lt; "Failed to initialize curl." &lt;&lt; std::endl;
        return -1;
    }

    curl_easy_setopt(curl, CURLOPT_URL, url.c_str());
    curl_easy_setopt(curl, CURLOPT_NOBODY, 1L);

    CURLcode res = curl_easy_perform(curl);
    if (res != CURLE_OK) {
        std::cerr &lt;&lt; "Failed to get file size. Error code: " &lt;&lt; res &lt;&lt; std::endl;
        return -1;
    }

    double contentLength;
    res = curl_easy_getinfo(curl, CURLINFO_CONTENT_LENGTH_DOWNLOAD, &amp;contentLength);
    if (res != CURLE_OK || contentLength &lt; 0) {
        std::cerr &lt;&lt; "Failed to get file size. Error code: " &lt;&lt; res &lt;&lt; std::endl;
        return -1;
    }

    curl_easy_cleanup(curl);

    return (long long)contentLength;
}

// 下载指定字节范围内的数据
int downloadRange(const std::string&amp; url, const std::string&amp; outputPath, long long startByte, long long endByte, int threadId) {
    CURL* curl = curl_easy_init();
    if (!curl) {
        std::cerr &lt;&lt; "Failed to initialize curl." &lt;&lt; std::endl;
        return -1;
    }

    FILE* fp = fopen(outputPath.c_str(), "rb+");
    if (!fp) {
        std::cerr &lt;&lt; "Failed to open file for writing." &lt;&lt; std::endl;
        return -1;
    }

    fseek(fp, startByte, SEEK_SET);

    // 设置请求头，指定下载范围
    char range[64];
    sprintf(range, "%lld-%lld", startByte, endByte);
    struct curl_slist* headers = NULL;
    headers = curl_slist_append(headers, range);
    curl_easy_setopt(curl, CURLOPT_HTTPHEADER, headers);

    curl_easy_setopt(curl, CURLOPT_URL, url.c_str());
    curl_easy_setopt(curl, CURLOPT_WRITEDATA, fp);
    curl_easy_setopt(curl, CURLOPT_WRITEFUNCTION, NULL);
    curl_easy_setopt(curl, CURLOPT_NOSIGNAL, 1L);
    curl_easy_setopt(curl, CURLOPT_LOW_SPEED_LIMIT, 1L);
    curl_easy_setopt(curl, CURLOPT_LOW_SPEED_TIME, 5L);
    curl_easy_setopt(curl, CURLOPT_NOPROGRESS, 0L);
    curl_easy_setopt(curl, CURLOPT_XFERINFOFUNCTION, [](void* clientp, curl_off_t dltotal, curl_off_t dlnow, curl_off_t ultotal, curl_off_t ulnow) {
        ThreadState* state = (ThreadState*)clientp;
        state->speed = (double)dlnow / 1024.0 / (double)(timeGetTime() - state->startByte) * 1000.0;
        return 0;
    });
    curl_easy_setopt(curl, CURLOPT_XFERINFODATA, &amp;threadStates[threadId]);

    CURLcode res = curl_easy_perform(curl);
    if (res != CURLE_OK) {
        std::cerr &lt;&lt; "Failed to download data. Error code: " &lt;&lt; res &lt;&lt; std::endl;
        fclose(fp);
        return -1;
    }

    fclose(fp);

    curl_slist_free_all(headers);
    curl_easy_cleanup(curl);

    threadStates[threadId].isFinished = 1;

    return 0;
}
int DownLoadFileMutliThreads(std::string targetUrl,std::string savePath,int threadCount){
    // 多线程下载文件
    std::string url = targetUrl;
    std::string outputPath = savePath;
    // 获取文件总大小
    long long fileSize = getFileSize(url);
    if (fileSize &lt;= 0) {
        return -1;
    }
    printf("fileSize: %d\n",fileSize);

    // 创建多个线程并分配下载范围
    int numThreads = threadCount;// 3;//8;
    threadStates.resize(numThreads);
    long long bytesPerThread = fileSize / numThreads;
    for (int i = 0; i &lt; numThreads; ++i) {
        threadStates[i].threadId = i;
        threadStates[i].startByte = i * bytesPerThread;
        threadStates[i].endByte = (i == numThreads - 1) ? fileSize - 1 : (i + 1) * bytesPerThread - 1;
        threadStates[i].isFinished = 0;

        char range[64];
        sprintf(range, "%lld-%lld", threadStates[i].startByte, threadStates[i].endByte);
        std::cout &lt;&lt; "Thread " &lt;&lt; i &lt;&lt; ": " &lt;&lt; range &lt;&lt; std::endl;

        threadStates[i].fp = fopen(outputPath.c_str(), "wb");
        if (!threadStates[i].fp) {
            std::cerr &lt;&lt; "Failed to open file for writing." &lt;&lt; std::endl;
            return -1;
        }

        threadStates[i].curlHandle = curl_easy_init();
        if (!threadStates[i].curlHandle) {
            std::cerr &lt;&lt; "Failed to initialize curl." &lt;&lt; std::endl;
            return -1;
        }
    }

    // 创建多个线程进行下载
    std::vector<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">std:</span>:thread</span><span class="token punctuation">></span></span> threads;
    for (int i = 0; i &lt; numThreads; ++i) {
        threads.emplace_back(std::thread(downloadRange, url, outputPath, threadStates[i].startByte, threadStates[i].endByte, i));
    }

    // 等待所有线程完成下载
    int finishedCount = 0;
    while (finishedCount &lt; numThreads) {
        finishedCount = 0;
        double totalSpeed = 0.0;
        for (int i = 0; i &lt; numThreads; ++i) {
            if (threadStates[i].isFinished) {
                ++finishedCount;
            }
            else {
                totalSpeed += threadStates[i].speed;
            }
        }
        printf("Downloaded %.2f%%. Speed: %.2f KB/s.\n", (double)finishedCount / (double)numThreads * 100.0, totalSpeed);
        Sleep(1000);
        printf("finishedCount: %d numThreads: %d \n",finishedCount,numThreads);
    }

    // 关闭文件指针和 CURL 句柄
    for (int i = 0; i &lt; numThreads; ++i) {
        fclose(threadStates[i].fp);
        curl_easy_cleanup(threadStates[i].curlHandle);
    }
    printf("success over");
}

int main(int argc, char *argv[])
{
    DownLoadFileMutliThreads("http://www.xx-xxxxx.com.cn/img/xx_top_logo_90.png","./mybig.png",3);
    return 0;
}
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="Windows下使用libcurl进行多线程下载FTP大文件"><a href="#Windows下使用libcurl进行多线程下载FTP大文件" class="headerlink" title="Windows下使用libcurl进行多线程下载FTP大文件"></a>Windows下使用libcurl进行多线程下载FTP大文件</h3><pre class="line-numbers language-html"><code class="language-html">#include <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>iostream</span><span class="token punctuation">></span></span>
#include <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>thread</span><span class="token punctuation">></span></span>
#include <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mutex</span><span class="token punctuation">></span></span>
#include <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>fstream</span><span class="token punctuation">></span></span>
#include <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>vector</span><span class="token punctuation">></span></span>
#include &lt;curl/curl.h>

// 定义每个线程的下载范围
struct Range {
    long long start;
    long long end;
};

// 下载线程函数
void DownloadThread(const std::string&amp; url, const std::string&amp; username, const std::string&amp; password,
    const std::string&amp; localPath, const Range&amp; range) {
    CURL* curl = curl_easy_init();
    if (!curl) {
        fprintf(stderr, "Failed to initialize libcurl.\n");
        return;
    }

    // 打开本地文件并设置写入位置
    std::string tempPath = localPath + ".part";
    std::ofstream file(tempPath, std::ios::out | std::ios::binary | std::ios::app);
    if (!file.is_open()) {
        fprintf(stderr, "Failed to open file: %s\n", tempPath.c_str());
        curl_easy_cleanup(curl);
        return;
    }
    file.seekp(range.start);

    // 设置libcurl的URL、用户名和密码
    curl_easy_setopt(curl, CURLOPT_URL, url.c_str());
    curl_easy_setopt(curl, CURLOPT_USERPWD, (username + ":" + password).c_str());

    // 设置写入文件的回调函数
    curl_easy_setopt(curl, CURLOPT_WRITEDATA, &amp;file);
    curl_easy_setopt(curl, CURLOPT_WRITEFUNCTION, [](void* contents, size_t size, size_t nmemb, void* userp) -> size_t {
        std::ofstream* file = (std::ofstream*)userp;
        file->write((char*)contents, size * nmemb);
        return size * nmemb;
    });

    // 设置下载范围
    std::string rangeHeader = std::to_string(range.start) + "-" + std::to_string(range.end);
    curl_easy_setopt(curl, CURLOPT_RANGE, rangeHeader.c_str());

    // 执行下载
    CURLcode res = curl_easy_perform(curl);
    file.close();
    curl_easy_cleanup(curl);

    if (res != CURLE_OK) {
        fprintf(stderr, "Failed to download file: %s\n", curl_easy_strerror(res));
        std::remove(tempPath.c_str());
    } else {
        // 将临时文件重命名为最终文件
        std::rename(tempPath.c_str(), localPath.c_str());
        printf("Download finished: %s\n", localPath.c_str());
    }
}

// 多线程下载函数
void MultiThreadDownload(const std::string&amp; url, const std::string&amp; username, const std::string&amp; password,
    const std::string&amp; localPath, int threadCount) {
    CURL* curl = curl_easy_init();
    if (!curl) {
        fprintf(stderr, "Failed to initialize libcurl.\n");
        return;
    }

    // 获取文件大小
    curl_easy_setopt(curl, CURLOPT_URL, url.c_str());
    curl_easy_setopt(curl, CURLOPT_USERPWD, (username + ":" + password).c_str());
    curl_easy_setopt(curl, CURLOPT_NOBODY, 1L);
    CURLcode res = curl_easy_perform(curl);
    double fileSize = 0;
    curl_easy_getinfo(curl, CURLINFO_CONTENT_LENGTH_DOWNLOAD, &amp;fileSize);
    curl_easy_cleanup(curl);

    if (res != CURLE_OK || fileSize &lt;= 0) {
        fprintf(stderr, "Failed to get file size: %s\n", curl_easy_strerror(res));
        return;
    }

    printf("File size: %.2f MB\n", fileSize / (1024 * 1024));

    // 计算每个线程的下载范围
    std::vector<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Range</span><span class="token punctuation">></span></span> ranges(threadCount);
    long long rangeSize = fileSize / threadCount;
    for (int i = 0; i &lt; threadCount; ++i) {
        ranges[i].start = i * rangeSize;
        ranges[i].end = (i == threadCount - 1) ? (fileSize - 1) : ((i + 1) * rangeSize - 1);
    }

    // 创建下载线程
    std::vector<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">std:</span>:thread</span><span class="token punctuation">></span></span> threads;
    for (int i = 0; i &lt; threadCount; ++i) {
        threads.emplace_back(DownloadThread, url, username, password, localPath, ranges[i]);
    }

    // 等待所有线程完成下载
    for (std::thread&amp; thread : threads) {
        thread.join();
    }
}

int main() {
    // 初始化libcurl
    curl_global_init(CURL_GLOBAL_ALL);

    // 设置下载参数
    std::string url = "ftp://example.com/path/to/file";
    std::string username = "username";
    std::string password = "password";
    std::string localPath = "C:\\path\\to\\local\\file";
    int threadCount = 4;

    // 多线程下载
    MultiThreadDownload(url, username, password, localPath, threadCount);

    // 清理资源
    curl_global_cleanup();

    return 0;
}
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="libcurl结合C-11线程池效率遍历和-普通-下载FTP目录内的所有文件及其子目录内的文件"><a href="#libcurl结合C-11线程池效率遍历和-普通-下载FTP目录内的所有文件及其子目录内的文件" class="headerlink" title="libcurl结合C++11线程池效率遍历和(普通)下载FTP目录内的所有文件及其子目录内的文件"></a>libcurl结合C++11线程池效率遍历和(普通)下载FTP目录内的所有文件及其子目录内的文件</h3><p>使用了一个自定义的C++11线程池来进行任务调度，并使用libcurl库来遍历FTP目录和下载文件。<br>在main函数中创建线程池时，我们使用了std::thread::hardware_concurrency()函数来获取当前系统支持的最大并发线程数，以充分利用系统资源  </p>
<pre class="line-numbers language-html"><code class="language-html">#include <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>iostream</span><span class="token punctuation">></span></span>
#include <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>thread</span><span class="token punctuation">></span></span>
#include <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mutex</span><span class="token punctuation">></span></span>
#include <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>queue</span><span class="token punctuation">></span></span>
#include <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>condition_variable</span><span class="token punctuation">></span></span>
#include &lt;curl/curl.h>

// 线程池类
class ThreadPool {
public:
    // 构造函数
    ThreadPool(size_t threadCount) : stop(false) {
        for (size_t i = 0; i &lt; threadCount; ++i)
            threads.emplace_back([this] {
                while (true) {
                    std::unique_lock<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">std:</span>:mutex</span><span class="token punctuation">></span></span> lock(this->queue_mutex);
                    this->condition.wait(lock, [this] {
                        return this->stop || !this->tasks.empty();
                    });
                    if (this->stop &amp;&amp; this->tasks.empty())
                        return;
                    auto task = std::move(this->tasks.front());
                    this->tasks.pop();
                    lock.unlock();
                    task();
                }
            });
    }

    // 析构函数
    ~ThreadPool() {
        {
            std::unique_lock<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">std:</span>:mutex</span><span class="token punctuation">></span></span> lock(queue_mutex);
            stop = true;
        }
        condition.notify_all();
        for (std::thread&amp; thread : threads)
            thread.join();
    }

    // 提交任务
    template<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>class</span> <span class="token attr-name">F,</span> <span class="token attr-name">class...</span> <span class="token attr-name">Args</span><span class="token punctuation">></span></span>
    auto enqueue(F&amp;&amp; f, Args&amp;&amp;... args)
    -> std::future<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>typename</span> <span class="token attr-name"><span class="token namespace">std:</span>:result_of&lt;F(Args...)</span><span class="token punctuation">></span></span>::type> {
        using return_type = typename std::result_of<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>F(Args...)</span><span class="token punctuation">></span></span>::type;
        auto task = std::make_shared&lt;std::packaged_task<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>return_type()</span><span class="token punctuation">></span></span>>(
            std::bind(std::forward<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>F</span><span class="token punctuation">></span></span>(f), std::forward<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Args</span><span class="token punctuation">></span></span>(args)...)
        );
        std::future<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>return_type</span><span class="token punctuation">></span></span> res = task->get_future();
        {
            std::unique_lock<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">std:</span>:mutex</span><span class="token punctuation">></span></span> lock(queue_mutex);
            if (stop)
                throw std::runtime_error("enqueue on stopped ThreadPool");
            tasks.emplace([task] { (*task)(); });
        }
        condition.notify_one();
        return res;
    }

private:
    // 工作线程
    std::vector<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">std:</span>:thread</span><span class="token punctuation">></span></span> threads;

    // 任务队列
    std::queue&lt;std::function<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>void()</span><span class="token punctuation">></span></span>> tasks;

    // 互斥锁和条件变量
    std::mutex queue_mutex;
    std::condition_variable condition;

    // 线程池是否停止
    bool stop;
};

// 文件下载回调函数
size_t WriteCallback(void* contents, size_t size, size_t nmemb, void* userp) {
    size_t totalSize = size * nmemb;
    fwrite(contents, 1, totalSize, (FILE*)userp);
    return totalSize;
}

// FTP目录遍历函数
void DownloadFtpDirectory(CURL* curl, const std::string&amp; url, const std::string&amp; username,
    const std::string&amp; password, const std::string&amp; localPath, ThreadPool&amp; pool) {
    // 进入FTP目录
    curl_easy_setopt(curl, CURLOPT_URL, url.c_str());
    curl_easy_setopt(curl, CURLOPT_USERPWD, (username + ":" + password).c_str());
    CURLcode res = curl_easy_perform(curl);

    if (res != CURLE_OK) {
        fprintf(stderr, "Failed to enter directory: %s\n", curl_easy_strerror(res));
        return;
    }

    // 读取FTP目录内容
    std::string listing;
    curl_easy_setopt(curl, CURLOPT_WRITEDATA, &amp;listing);
    curl_easy_setopt(curl, CURLOPT_WRITEFUNCTION, WriteCallback);
    curl_easy_setopt(curl, CURLOPT_QUOTE, "-aL");
    curl_easy_perform(curl);

    // 解析FTP目录内容
    std::istringstream iss(listing);
    std::string line;
    while (std::getline(iss, line)) {
        std::istringstream ls(line);
        std::string permissions;
        std::string owner;
        std::string group;
        std::string size;
        std::string month;
        std::string day;
        std::string yearOrTime;
        std::string name;

        ls >> permissions >> owner >> group >> size >> month >> day >> yearOrTime >> name;

        if (name == "." || name == "..")
            continue;

        std::string remotePath = url + "/" + name;
        std::string localFilePath = localPath + "/" + name;

        if (permissions[0] == 'd') {
            // 如果是目录，则提交到线程池进行递归遍历
            if (!CreateDirectoryA(localFilePath.c_str(), NULL) &amp;&amp; ERROR_ALREADY_EXISTS != GetLastError()) {
                fprintf(stderr, "Failed to create directory: %s\n", localFilePath.c_str());
                continue;
            }
            pool.enqueue(DownloadFtpDirectory, curl, remotePath, username, password, localFilePath,
                std::ref(pool));
        } else {
            // 如果是文件，则提交到线程池进行普通下载
            pool.enqueue([curl, remotePath, username, password, localFilePath] {
                FILE* fp = fopen(localFilePath.c_str(), "wb");
                if (!fp) {
                    fprintf(stderr, "Failed to create file: %s\n", localFilePath.c_str());
                    return;
                }
                curl_easy_setopt(curl, CURLOPT_URL, remotePath.c_str());
                curl_easy_setopt(curl, CURLOPT_USERPWD, (username + ":" + password).c_str());
                curl_easy_setopt(curl, CURLOPT_WRITEDATA, fp);
                curl_easy_setopt(curl, CURLOPT_WRITEFUNCTION, WriteCallback);
                CURLcode res = curl_easy_perform(curl);
                fclose(fp);
                if (res != CURLE_OK)
                    fprintf(stderr, "Failed to download file: %s\n", curl_easy_strerror(res));
            });
        }
    }
}

int main() {
    // 初始化libcurl
    curl_global_init(CURL_GLOBAL_ALL);
    CURL* curl = curl_easy_init();
    if (!curl) {
        fprintf(stderr, "Failed to initialize libcurl.\n");
        return -1;
    }

    // 创建线程池
    ThreadPool pool(std::thread::hardware_concurrency());

    // 遍历FTP目录并下载内容
    DownloadFtpDirectory(curl, "ftp://example.com/path", "username", "password", "C:\\local\\path", pool);

    // 清理资源
    curl_easy_cleanup(curl);
    curl_global_cleanup();

    return 0;
}

<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="线程池遍历和下载FTP目录内的所有文件及其子目录内的文件，并使用线程池分配多线程下载大文件"><a href="#线程池遍历和下载FTP目录内的所有文件及其子目录内的文件，并使用线程池分配多线程下载大文件" class="headerlink" title="线程池遍历和下载FTP目录内的所有文件及其子目录内的文件，并使用线程池分配多线程下载大文件"></a>线程池遍历和下载FTP目录内的所有文件及其子目录内的文件，并使用线程池分配多线程下载大文件</h3><pre class="line-numbers language-html"><code class="language-html">#include <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>iostream</span><span class="token punctuation">></span></span>
#include <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>thread</span><span class="token punctuation">></span></span>
#include <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mutex</span><span class="token punctuation">></span></span>
#include <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>fstream</span><span class="token punctuation">></span></span>
#include <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>vector</span><span class="token punctuation">></span></span>
#include <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>queue</span><span class="token punctuation">></span></span>
#include <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>condition_variable</span><span class="token punctuation">></span></span>
#include <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>functional</span><span class="token punctuation">></span></span>
#include &lt;curl/curl.h>
#include "ThreadPool.h" // 假设你已经有一个实现好的线程池

// 定义FTP文件信息结构体
struct FtpFileInfo {
    std::string name;
    bool isDirectory;
    long long size;
};

// 全局变量
std::mutex mtx;  // 互斥锁
std::condition_variable cv;  // 条件变量
std::queue<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">std:</span>:string</span><span class="token punctuation">></span></span> downloadQueue;  // 下载任务队列
std::vector<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>FtpFileInfo</span><span class="token punctuation">></span></span> ftpFiles;  // 存储FTP文件信息
ThreadPool threadPool(4);  // 线程池

// FTP回调函数，用于获取文件和目录列表
size_t FtpListCallback(void* contents, size_t size, size_t nmemb, void* userp) {
    std::string line((char*)contents, size * nmemb);

    // 解析文件信息
    FtpFileInfo fileInfo;
    if (line.size() >= 56 &amp;&amp; line[0] != 'd') {
        fileInfo.isDirectory = false;
        fileInfo.name = line.substr(55);
        fileInfo.size = std::stoll(line.substr(29, 10));
    } else {
        fileInfo.isDirectory = true;
        fileInfo.name = line.substr(55);
        fileInfo.size = 0;
    }

    // 存储文件信息
    std::lock_guard<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">std:</span>:mutex</span><span class="token punctuation">></span></span> lock(mtx);
    ftpFiles.push_back(fileInfo);

    return size * nmemb;
}

// FTP目录遍历函数
void FtpDirectoryTraversal(const std::string&amp; url, const std::string&amp; username, const std::string&amp; password) {
    CURL* curl = curl_easy_init();
    if (!curl) {
        fprintf(stderr, "Failed to initialize libcurl.\n");
        return;
    }

    // 设置libcurl的URL、用户名和密码
    curl_easy_setopt(curl, CURLOPT_URL, url.c_str());
    curl_easy_setopt(curl, CURLOPT_USERPWD, (username + ":" + password).c_str());

    // 设置FTP回调函数
    curl_easy_setopt(curl, CURLOPT_CUSTOMREQUEST, "NLST");
    curl_easy_setopt(curl, CURLOPT_WRITEFUNCTION, FtpListCallback);

    // 执行遍历
    CURLcode res = curl_easy_perform(curl);
    curl_easy_cleanup(curl);

    if (res != CURLE_OK) {
        fprintf(stderr, "Failed to traverse FTP directory: %s\n", curl_easy_strerror(res));
        return;
    }

    // 遍历FTP文件列表
    for (const FtpFileInfo&amp; fileInfo : ftpFiles) {
        if (fileInfo.isDirectory) {
            // 递归遍历子目录
            FtpDirectoryTraversal(url + fileInfo.name + "/", username, password);
        } else {
            // 将大文件添加到下载任务队列
            if (fileInfo.size > 100 * 1024 * 1024) {
                std::lock_guard<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">std:</span>:mutex</span><span class="token punctuation">></span></span> lock(mtx);
                downloadQueue.push(url + fileInfo.name);
                cv.notify_all();
            } else {
                // 将小文件添加到线程池中下载
                threadPool.enqueue([=]() {
                    curl = curl_easy_init();
                    if (!curl) {
                        fprintf(stderr, "Failed to initialize libcurl.\n");
                        return;
                    }

                    // 设置libcurl的URL、用户名和密码
                    curl_easy_setopt(curl, CURLOPT_URL, (url + fileInfo.name).c_str());
                    curl_easy_setopt(curl, CURLOPT_USERPWD, (username + ":" + password).c_str());

                    // 打开本地文件并设置写入位置
                    std::string localPath = /* 生成本地文件路径 */;
                    std::ofstream file(localPath, std::ios::out | std::ios::binary);
                    if (!file.is_open()) {
                        fprintf(stderr, "Failed to open file: %s\n", localPath.c_str());
                        return;
                    }
                    curl_easy_setopt(curl, CURLOPT_WRITEDATA, &amp;file);

                    // 执行下载
                    CURLcode res = curl_easy_perform(curl);
                    file.close();

                    if (res != CURLE_OK) {
                        fprintf(stderr, "Failed to download file: %s\n", curl_easy_strerror(res));
                        std::remove(localPath.c_str());
                    } else {
                        printf("Download finished: %s\n", localPath.c_str());
                    }

                    curl_easy_cleanup(curl);
                });
            }
        }
    }
}

// 下载线程函数
void DownloadThread(const std::string&amp; url, const std::string&amp; username, const std::string&amp; password) {
    CURL* curl = curl_easy_init();
    if (!curl) {
        fprintf(stderr, "Failed to initialize libcurl.\n");
        return;
    }

    // 设置libcurl的URL、用户名和密码
    curl_easy_setopt(curl, CURLOPT_USERPWD, (username + ":" + password).c_str());

    // 设置写入文件的回调函数
    std::ofstream file;
    curl_easy_setopt(curl, CURLOPT_WRITEFUNCTION, [](void* contents, size_t size, size_t nmemb, void* userp) -> size_t {
        std::ofstream* file = (std::ofstream*)userp;
        file->write((char*)contents, size * nmemb);
        return size * nmemb;
    });

    // 从下载任务队列中获取待下载的文件并执行下载
    while (true) {
        std::unique_lock<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">std:</span>:mutex</span><span class="token punctuation">></span></span> lock(mtx);
        cv.wait(lock, [] { return !downloadQueue.empty(); });
        std::string fileUrl = downloadQueue.front();
        downloadQueue.pop();
        lock.unlock();

        // 打开本地文件并设置写入位置
        std::string localPath = /* 生成本地文件路径 */;
        file.open(localPath, std::ios::out | std::ios::binary | std::ios::app);
        if (!file.is_open()) {
            fprintf(stderr, "Failed to open file: %s\n", localPath.c_str());
            continue;
        }

        // 设置libcurl的URL
        curl_easy_setopt(curl, CURLOPT_URL, fileUrl.c_str());

        // 设置写入文件的回调函数参数
        curl_easy_setopt(curl, CURLOPT_WRITEDATA, &amp;file);

        // 执行下载
        CURLcode res = curl_easy_perform(curl);
        file.close();

        if (res != CURLE_OK) {
            fprintf(stderr, "Failed to download file: %s\n", curl_easy_strerror(res));
            std::remove(localPath.c_str());
        } else {
            printf("Download finished: %s\n", localPath.c_str());
        }
    }

    curl_easy_cleanup(curl);
}

int main() {
    // 初始化libcurl
    curl_global_init(CURL_GLOBAL_ALL);

    // 设置FTP参数
    std::string url = "ftp://example.com/path/to/directory/";
    std::string username = "username";
    std::string password = "password";

    // 启动线程池
    threadPool.start();

    // 进行FTP目录遍历
    FtpDirectoryTraversal(url, username, password);

    // 创建下载线程
    for (int i = 0; i &lt; threadPool.getThreadCount(); ++i) {
        std::thread(DownloadThread, url, username, password).detach();
    }

    // 停止线程池
    threadPool.stop();

    // 清理资源
    curl_global_cleanup();

    return 0;
}
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="qt5-5通过libcurl获取文件列表、大小、"><a href="#qt5-5通过libcurl获取文件列表、大小、" class="headerlink" title="qt5.5通过libcurl获取文件列表、大小、"></a>qt5.5通过libcurl获取文件列表、大小、</h2><h3 id="testcurl-pro"><a href="#testcurl-pro" class="headerlink" title="testcurl.pro"></a>testcurl.pro</h3><pre class="line-numbers language-html"><code class="language-html">TEMPLATE = app
CONFIG += console c++11
CONFIG -= app_bundle
CONFIG -= qt

INCLUDEPATH += $$PWD/../3rd/curl_8.5.0_5_win32_mingw/include
LIBS += $$PWD/../3rd/curl_8.5.0_5_win32_mingw/lib/lib*.a

SOURCES += main.cpp
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="main-cpp"><a href="#main-cpp" class="headerlink" title="main.cpp"></a>main.cpp</h3><pre class="line-numbers language-html"><code class="language-html">#include <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>iostream</span><span class="token punctuation">></span></span>

#include &lt;curl/curl.h>
#include &lt;curl/easy.h>

#include <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>fstream</span><span class="token punctuation">></span></span>
#include <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>string</span><span class="token punctuation">></span></span>
#include <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>iomanip</span><span class="token punctuation">></span></span>

using namespace std;


// 下载文件的回调函数，用于写入下载的数据
size_t write_data(void *ptr, size_t size, size_t nmemb, FILE *stream) {
    size_t written;
    written = fwrite(ptr, size, nmemb, stream);
    if(written &lt;=0){
        printf("nothing written!!");
    }
    return written;
}
// 下载文件进度的回调函数
int my_progress_func(char *progress_data,double dltotal, double dlnow, double ultotal,double ulnow)
{
    if ((int)(dlnow*100.0 / dltotal) % 5 == 0)
    {
//        printf("%s %g / %g (%g %%)\n", progress_data, dlnow, dltotal, dlnow*100.0 / dltotal);
        printf("%g / %g (%g %%)\n",  dlnow, dltotal, dlnow*100.0 / dltotal);
    }
    return 0;
}

// 下载文件 不支持https,  测试可以下载 (局域网内共享文件)file://和http:// 小文件
int DOWNLOAD_FILE(const char* url, const char outfilename[FILENAME_MAX]){
    // url = "" , outfilename = "";
    CURL *curl;
    FILE *fp;
    CURLcode res;
    /*   调用curl_global_init()初始化libcurl  */
    res = curl_global_init(CURL_GLOBAL_ALL);
    if (CURLE_OK != res)
    {
        printf("init libcurl failed.");
        curl_global_cleanup();
        return -1;
    }
    /*  调用curl_easy_init()函数得到 easy interface型指针  */
    curl = curl_easy_init();
    if (curl) {

        fopen_s(&amp;fp,outfilename,"wb");

        /*  调用curl_easy_setopt()设置传输选项 */
        res = curl_easy_setopt(curl, CURLOPT_URL, url);
        if (res != CURLE_OK)
        {
            fclose(fp);
            curl_easy_cleanup(curl);
            return -1;
        }
        /*  根据curl_easy_setopt()设置的传输选项，实现回调函数以完成用户特定任务  */
        res = curl_easy_setopt(curl, CURLOPT_WRITEFUNCTION, write_data);
        if (res != CURLE_OK)
        {
            fclose(fp);
            curl_easy_cleanup(curl);
            return -1;
        }
        /*  根据curl_easy_setopt()设置的传输选项，实现回调函数以完成用户特定任务  */
        res = curl_easy_setopt(curl, CURLOPT_WRITEDATA, fp);
        if (res != CURLE_OK)
        {
            fclose(fp);
            curl_easy_cleanup(curl);
            return -1;
        }
        // 根据curl_easy_setopt()设置的传输选项，添加下载进度功能
        res = curl_easy_setopt(curl, CURLOPT_NOPROGRESS,0L);
        if(res !=CURLE_OK){
            fclose(fp);
            curl_easy_cleanup(curl);
            return -1;
        }
        // 根据curl_easy_setopt()设置的传输选项，添加下载进度函数
        res = curl_easy_setopt(curl, CURLOPT_PROGRESSFUNCTION,my_progress_func);
        if(res !=CURLE_OK){
            fclose(fp);
            curl_easy_cleanup(curl);
            return -1;
        }
        // 根据curl_easy_setopt()设置的传输选项，添加下载进度对象
        res = curl_easy_setopt(curl, CURLOPT_PROGRESSDATA,curl);
        if(res !=CURLE_OK){
            fclose(fp);
            curl_easy_cleanup(curl);
            return -1;
        }

        // 调用curl_easy_perform()函数完成传输任务
        res = curl_easy_perform(curl);
        fclose(fp);
        /* Check for errors */
        if(res != CURLE_OK){
            fprintf(stderr, "curl_easy_perform() failed: %s\n",curl_easy_strerror(res));
            curl_easy_cleanup(curl);
            return -1;
        }else{
            printf("download complete success.\n");
        }

        /* always cleanup */
        // 调用curl_easy_cleanup()释放内存
        curl_easy_cleanup(curl);   

    }
    curl_global_cleanup();
    return 0;
}

// 访问网络文件内容到缓存里看结果
size_t WriteCallback(void* contents, size_t size, size_t nmemb, std::string* buffer)
{
    size_t totalSize = size * nmemb;
    buffer->append((char*)contents, totalSize);
    return totalSize;
}
// 获取目标文件大小
size_t get_size_struct(void* ptr, size_t size, size_t nmemb, void* data) {
    return (size_t)(size * nmemb);
}
double GetRemoteFileSize2(const char* url) {
// 通过HTTP的HEAD方式来获取的，但是并不是所有HTTP的服务器都是支持HEAD方式来获取
//    url="file://192.168.157.134/smbshare2/curl-8.5.0_5-win64-mingw.zip";

    CURL* curl;
    CURLcode res;
    double size = 0.0;

    curl = curl_easy_init();
    curl_easy_setopt(curl, CURLOPT_URL, url);
    curl_easy_setopt(curl, CURLOPT_NOBODY, 1L);
    curl_easy_setopt(curl, CURLOPT_HEADERFUNCTION, get_size_struct);
    curl_easy_setopt(curl, CURLOPT_FOLLOWLOCATION, 1L);

    res = curl_easy_perform(curl);
    res = curl_easy_getinfo(curl, CURLINFO_CONTENT_LENGTH_DOWNLOAD, &amp;size);
    if (res != CURLE_OK) {
        fprintf(stderr, "curl_easy_getinfo() failed: %s\n", curl_easy_strerror(res));
    }
    curl_easy_cleanup(curl);

    std::cout &lt;&lt; "Size in KB: " &lt;&lt; (size / 1024 ) &lt;&lt;" (KB)"&lt;&lt; std::endl;
    std::cout &lt;&lt; "Size in MB: " &lt;&lt; (size / (1024 * 1024)) &lt;&lt;" (MB)"&lt;&lt; std::endl;
    std::cout &lt;&lt; "Size in GB: " &lt;&lt; (size / (1024 * 1024 * 1024)) &lt;&lt;" (GB)"&lt;&lt; std::endl;

    return size;
}

double GetRemoteFileSize(const char* url) {
    // 这种GET方式解决获取文件长度，而不下载文件内容
//    url="file://192.168.157.134/smbshare2/curl-8.5.0_5-win64-mingw.zip";

    CURL* curl;
    CURLcode res;
    double size = 0.0;

    curl = curl_easy_init();
    curl_easy_setopt(curl, CURLOPT_URL, url);
    curl_easy_setopt(curl, CURLOPT_NOBODY, 1L); //不需求body
    curl_easy_setopt(curl, CURLOPT_CUSTOMREQUEST, "GET");    //使用CURLOPT_CUSTOMREQUEST

    if(curl_easy_perform(curl)==CURLE_OK){
        curl_easy_getinfo(curl, CURLINFO_CONTENT_LENGTH_DOWNLOAD, &amp;size);
        std::cout &lt;&lt; "Size in KB: " &lt;&lt; (size / 1024 ) &lt;&lt;" (KB)"&lt;&lt; std::endl;
        std::cout &lt;&lt; "Size in MB: " &lt;&lt; (size / (1024 * 1024)) &lt;&lt;" (MB)"&lt;&lt; std::endl;
        std::cout &lt;&lt; "Size in GB: " &lt;&lt; (size / (1024 * 1024 * 1024)) &lt;&lt;" (GB)"&lt;&lt; std::endl;
    }else{
        size=-1;
        std::cout &lt;&lt; "GetRemoteFileSize failed"&lt;&lt; std::endl;
    }
    curl_easy_cleanup(curl);

    return size;
}


void GetRemoteContentInCache(std::string url){
    // 访问网络文件内容到缓存里看结果
    CURL* curl;
    CURLcode res;
//    std::string url = "file://192.168.157.134/smbshare2/999.txt";
    std::string buffer;

    curl_global_init(CURL_GLOBAL_DEFAULT);

    curl = curl_easy_init();
    if (curl)
    {
        curl_easy_setopt(curl, CURLOPT_URL, url.c_str());
        curl_easy_setopt(curl, CURLOPT_WRITEFUNCTION, WriteCallback);
        curl_easy_setopt(curl, CURLOPT_WRITEDATA, &amp;buffer);

        res = curl_easy_perform(curl);
        if (res != CURLE_OK)
        {
            std::cout &lt;&lt; "Failed to download file: " &lt;&lt; curl_easy_strerror(res) &lt;&lt; std::endl;
        }

        curl_easy_cleanup(curl);
    }

    curl_global_cleanup();

    if (!buffer.empty())
    {
        std::cout &lt;&lt; "Remote File content:\n" &lt;&lt; buffer.c_str() &lt;&lt; std::endl;
    }
}
void DownLoadFile(std::string targetUrl,std::string savePath){
    // 简单下载文件
//    std::string url0 = "http://www.zhdgps.com/images/ln23p.png";
//    std::string url1 = "file://192.168.157.134/smbshare2/curl-8.5.0_5-win64-mingw.zip";
//    std::string savepath = "./my.zip";
//        savePath = "./../xyz.zip";
//    savePath="E:/Project/mymy.zip";

    DOWNLOAD_FILE(targetUrl.c_str(),savePath.c_str());

}



int GetFtpFile(){
    int ret=-1;
    CURL* curl;
    FILE* fp;
    CURLcode res;
    char* url="ftp://192.168.157.134/abcd.txt";
    url = "ftp://192.168.157.134/curl-8.5.0_5-win64-mingw.zip";
    char* outfilename="./ftpfile.txt";
    char* userpwd="abc:123456";
    curl_global_init(CURL_GLOBAL_DEFAULT);
    curl = curl_easy_init();
    if(curl){
        fp=fopen(outfilename,"wb");
        if(!fp){
            printf("can not open file");
            return ret;
        }

        curl_easy_setopt(curl, CURLOPT_URL, url);
        curl_easy_setopt(curl, CURLOPT_WRITEFUNCTION, write_data);
        curl_easy_setopt(curl, CURLOPT_WRITEDATA, fp);

        curl_easy_setopt(curl, CURLOPT_NOPROGRESS,0L);
        curl_easy_setopt(curl, CURLOPT_PROGRESSFUNCTION,my_progress_func);
        curl_easy_setopt(curl, CURLOPT_PROGRESSDATA,curl);

        curl_easy_setopt(curl, CURLOPT_USERPWD, userpwd); // 设置用户名和密码
        curl_easy_setopt(curl, CURLOPT_VERBOSE, 0L); // 如果你想要详细的执行过程信息，可以启用这个选项 1l输出详细信息 0L不输出

        res = curl_easy_perform(curl);
        if (res != CURLE_OK)
        {
            std::cout &lt;&lt; "Failed to download file: " &lt;&lt; curl_easy_strerror(res) &lt;&lt; std::endl;
        }else{
            ret = 0;
        }
        fclose(fp);
        curl_easy_cleanup(curl);
    }
    curl_global_cleanup();
    return ret;
}
// 获取FTP某目录下文件名列表
struct MemoryStruct {
  char *memory;
  size_t size;
};
size_t WriteMemoryCallback(void *contents, size_t size, size_t nmemb, void *userp) {
  size_t realsize = size * nmemb;
  struct MemoryStruct *mem = (struct MemoryStruct *)userp;

  char *ptr = (char*)realloc(mem->memory, mem->size + realsize + 1);
  if(ptr == NULL) {
    // out of memory!
    printf("not enough memory (realloc returned NULL)\n");
    return 0;
  }

  mem->memory = ptr;
  memcpy(&amp;(mem->memory[mem->size]), contents, realsize);
  mem->size += realsize;
  mem->memory[mem->size] = 0;

  return realsize;
}

void getFtpDirFileName(){
    struct MemoryStruct chunk;
    chunk.memory = (char*)malloc(1);
    chunk.size = 0;
    CURL* curl;
    CURLcode res;
    char* userpwd="abcd:112233";
    res = curl_global_init(CURL_GLOBAL_ALL);
    curl = curl_easy_init();
    if(curl){
        curl_easy_setopt(curl, CURLOPT_URL, "ftp://192.168.157.133/abcdel/");
        curl_easy_setopt(curl, CURLOPT_USERPWD, userpwd); // 设置用户名和密码
        curl_easy_setopt(curl, CURLOPT_DIRLISTONLY, 1L);
        curl_easy_setopt(curl, CURLOPT_WRITEFUNCTION, WriteMemoryCallback);
        curl_easy_setopt(curl, CURLOPT_WRITEDATA, (void *)&amp;chunk);
        curl_easy_setopt(curl, CURLOPT_USERAGENT, "libcurl-agent/1.0");
        res = curl_easy_perform(curl);
        if (res != CURLE_OK)
        {
            std::cout &lt;&lt; "Failed to get ftp dir " &lt;&lt; curl_easy_strerror(res) &lt;&lt; std::endl;
        }else{
            printf("%lu bytes retrieved, content:\n", (unsigned long)chunk.size);
            printf("%s",chunk.memory);
        }
        curl_easy_cleanup(curl);

    }
    free(chunk.memory);
    curl_global_cleanup();
}

int main(int argc, char* argv[])
{
    if(argc &lt; 2){
        std::cout &lt;&lt; "Please provide an argument." &lt;&lt; std::endl;
        return 1;
    }
    std::string argument = argv[1];
    if(argument == "DownLoadFile"){
//        DownLoadFile("file://192.168.157.134/smbshare2/curl-8.5.0_5-win64-mingw.zip","./my.zip");
        DownLoadFile("file://192.168.157.134/smbshare2/xxx.rar","./my.zip");
    }else if(argument == "GetRemoteFileSize"){
        GetRemoteFileSize("file://192.168.157.134/smbshare2/curl-8.5.0_5-win64-mingw1.zip");
    }else if(argument == "GetRemoteContentInCache"){
        GetRemoteContentInCache("file://192.168.157.134/smbshare2/999.txt");
    }else if(argument == "ftpdownload"){
        if(GetFtpFile()==0){
             cout &lt;&lt; "success download!" &lt;&lt; endl;
        }else{
             cout &lt;&lt; "failed downlaod" &lt;&lt; endl;
        }
    }else if(argument == "getftpdir"){
        getFtpDirFileName();
    } else {
        std::cout &lt;&lt; "Invalid argument." &lt;&lt; std::endl;
    }
    return 0;
}
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="qt5-5通过libcurl带界面批量下载"><a href="#qt5-5通过libcurl带界面批量下载" class="headerlink" title="qt5.5通过libcurl带界面批量下载"></a>qt5.5通过libcurl带界面批量下载</h2><blockquote>
<p>准备好./../3rd/curl_8.5.0_5_win32_mingw/<br>.pro里添加<br>    INCLUDEPATH += $$PWD/../3rd/curl_8.5.0_5_win32_mingw/include<br>   LIBS += $$PWD/../3rd/curl_8.5.0_5_win32_mingw/lib/lib*.a<br>添加新文件- C++ - C++Class - Class name: Downloader, Base class: QObject<br>界面上添加pushButton1，点击开始下载<br>界面上添加label1,用于显示下载是否成功<br>界面上添加progressBar1,用于显示下载进度条  </p>
<p>把./../3rd/curl_8.5.0_5_win32_mingw/bin/下”curl.exe curl-ca-bundle.crt libcurl.def libcurl.dll”<br>4个文件复制一份到目标编译位置 **/release/ 下<br>注意Ftp的ip地址、端口号、访问账号和密码填写正确</p>
</blockquote>
<h3 id="winlibcurl-pro"><a href="#winlibcurl-pro" class="headerlink" title="winlibcurl.pro"></a>winlibcurl.pro</h3><pre class="line-numbers language-html"><code class="language-html">QT       += core gui
greaterThan(QT_MAJOR_VERSION, 4): QT += widgets
TARGET = winlibcurl
TEMPLATE = app

INCLUDEPATH += $$PWD/../3rd/curl_8.5.0_5_win32_mingw/include
LIBS += $$PWD/../3rd/curl_8.5.0_5_win32_mingw/lib/lib*.a

SOURCES += main.cpp\
        mainwindow.cpp \
    downloader.cpp

HEADERS  += mainwindow.h \
    downloader.h

FORMS    += mainwindow.ui
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="自定义下载类downloader"><a href="#自定义下载类downloader" class="headerlink" title="自定义下载类downloader"></a>自定义下载类downloader</h3><pre class="line-numbers language-html"><code class="language-html">// downloader.h  
#ifndef DOWNLOADER_H
#define DOWNLOADER_H

#include <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>QObject</span><span class="token punctuation">></span></span>
#include &lt;curl/curl.h>
#include <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>iostream</span><span class="token punctuation">></span></span>
#include <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>QThread</span><span class="token punctuation">></span></span>
#include <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>QApplication</span><span class="token punctuation">></span></span>

#include <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>QDir</span><span class="token punctuation">></span></span>
#include <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>string</span><span class="token punctuation">></span></span>
#include <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>QMutex</span><span class="token punctuation">></span></span>


class Downloader : public QObject
{
    Q_OBJECT
public:
    explicit Downloader(QObject *parent = 0);

signals:
    void downloadProgress(double dlnow, double dltotal);
    void downloadFinished(bool success);


public slots:
    void startDownload(const QString&amp; url, const QString&amp; saveDir, const QString&amp; saveName){
        QThread* thread = new QThread;
        connect(thread,&amp;QThread::started,[=](){
              performDownload(std::string(url.toStdString().c_str()), saveDir, saveName);
        });
        connect(this,&amp;Downloader::downloadFinished,thread,&amp;QThread::quit);
        connect(thread,&amp;QThread::finished,thread,&amp;QThread::deleteLater);
        thread->start();
    }
private:
    QMutex mutex;
    // 下载文件的回调函数，用于写入下载的数据
    static size_t write_data(void *ptr, size_t size, size_t nmemb, FILE *stream){
        size_t written;
        written = fwrite(ptr, size, nmemb, stream);
        if(written &lt;=0){
            printf("nothing written!!");
        }
        return written;
    }
    // 下载文件进度的回调函数
    static int progressCallBack(void* progress_data,double dltotal, double dlnow, double ultotal,double ulnow){
        Downloader *downloader=static_cast<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Downloader*</span><span class="token punctuation">></span></span>(progress_data);
        emit downloader->downloadProgress(dlnow,dltotal);
        return 0;
    }
    // 请求字符转义，目前只处理空格
    std::string encodeSpecialCharacters(const std::string&amp; input){
        std::string result;
        for(int i=0;i&lt;input.length();i++){
            switch (input[i]) {
                case ' ':
                    result += "%20";
                    break;
//                case '!':
//                    result += "%21";
//                    break;
//                case '#':
//                    result += "%23";
//                    break;
//                case '$':
//                    result += "%24";
//                    break;
//                case '&amp;':
//                    result += "%26";
//                    break;
//                case '\'':
//                    result += "%27";
//                    break;
//                case '(':
//                    result += "%28";
//                    break;
//                case ')':
//                    result += "%29";
//                    break;
//                case '*':
//                    result += "%2A";
//                    break;
//                case '+':
//                    result += "%2B";
//                    break;
//                case ',':
//                    result += "%2C";
//                    break;
//                case '/':
//                    result += "%2F";
//                    break;
//                case ':':
//                    result += "%3A";
//                    break;
//                case ';':
//                    result += "%3B";
//                    break;
//                case '=':
//                    result += "%3D";
//                    break;
//                case '?':
//                    result += "%3F";
//                    break;
//                case '@':
//                    result += "%40";
//                    break;
//                case '[':
//                    result += "%5B";
//                    break;
//                case ']':
//                    result += "%5D";
//                    break;
                default:
                    result += input[i];
                    break;
            }
        }
        return result;
    }
    int performDownload(const std::string&amp; url, const QString&amp; saveFileDir, const QString&amp; saveFileName){
        int ret=-1;
        CURL* curl;
        FILE* fp;
        CURLcode res;
        QDir dir;
        if(!dir.exists(saveFileDir)){
            dir.mkpath(saveFileDir);
        }
        const QString saveFileUrl = saveFileDir + saveFileName;
        const char* outfilename= saveFileUrl.toLocal8Bit().constData(); //"newoutput/" + "ftpfile.txt";
        char* userpwd="abcd:112233";   // FTP账号名:FTP密码
        curl_global_init(CURL_GLOBAL_ALL);
        curl = curl_easy_init();
        if(curl){
            fp=fopen(outfilename,"wb");
            if(!fp){
                printf("can not open file");
                return ret;
            }

            std::string encodedString = encodeSpecialCharacters(url);
            curl_easy_setopt(curl, CURLOPT_URL, encodedString.c_str());
//            curl_easy_setopt(curl, CURLOPT_URL, url.c_str());
            curl_easy_setopt(curl, CURLOPT_WRITEFUNCTION, write_data);
            curl_easy_setopt(curl, CURLOPT_WRITEDATA, fp);
            curl_easy_setopt(curl, CURLOPT_NOPROGRESS,0L);
            curl_easy_setopt(curl, CURLOPT_PROGRESSFUNCTION,Downloader::progressCallBack);
            curl_easy_setopt(curl, CURLOPT_PROGRESSDATA,this);

            curl_easy_setopt(curl, CURLOPT_TRANSFERTEXT, 0);
            curl_easy_setopt(curl, CURLOPT_USERPWD, userpwd); // 设置用户名和密码
            curl_easy_setopt(curl, CURLOPT_VERBOSE, 0L); // 如果你想要详细的执行过程信息，可以启用这个选项 1l输出详细信息 0L不输出
            // 加锁
            mutex.lock();
            res = curl_easy_perform(curl);
            if (res != CURLE_OK)
            {
                emit downloadFinished(false);
            }else{
                emit downloadFinished(true);
                ret = 0;
            }
            // 解锁
            mutex.unlock();
            fclose(fp);
            curl_easy_cleanup(curl);
        }
        curl_global_cleanup();
        return ret;
    }
};
#endif // DOWNLOADER_H


// downloader.cpp  
#include "downloader.h"
Downloader::Downloader(QObject *parent) : QObject(parent)
{
}  

<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="mainwindow"><a href="#mainwindow" class="headerlink" title="mainwindow"></a>mainwindow</h3><pre class="line-numbers language-html"><code class="language-html">// mainwindow.h  
#ifndef MAINWINDOW_H
#define MAINWINDOW_H

#include <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>QMainWindow</span><span class="token punctuation">></span></span>
#include "downloader.h"

namespace Ui {
class MainWindow;
}

class MainWindow : public QMainWindow
{
    Q_OBJECT

public:
    explicit MainWindow(QWidget *parent = 0);
    ~MainWindow();

private:
    Ui::MainWindow *ui;
    Downloader downloader;

public slots:
    void onPushButton1Clicked();
    void onUpdateDownloaderProgress(double dlnow, double dltotal);
};
#endif // MAINWINDOW_H


//mainwindow.cpp  
#include "mainwindow.h"
#include "ui_mainwindow.h"
#include <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>QFileInfo</span><span class="token punctuation">></span></span>
#include <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>QDebug</span><span class="token punctuation">></span></span>

MainWindow::MainWindow(QWidget *parent) :
    QMainWindow(parent),
    ui(new Ui::MainWindow)
{
    ui->setupUi(this);

    QObject::connect(&amp;downloader, &amp;Downloader::downloadProgress,this,&amp;MainWindow::onUpdateDownloaderProgress);
    QObject::connect(&amp;downloader, &amp;Downloader::downloadFinished,[&amp;](bool success){
       if(success){
            ui->label1->setText("download success");
            qDebug()&lt;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>"download</span> <span class="token attr-name">success";</span>
       <span class="token attr-name">}else{</span>
            <span class="token attr-name">ui-</span><span class="token punctuation">></span></span>label1->setText("download failed");
       }
    });
    connect(ui->pushButton1,SIGNAL(clicked()),this,SLOT(onPushButton1Clicked()));
}

MainWindow::~MainWindow()
{
    delete ui;
}

void MainWindow::onUpdateDownloaderProgress(double dlnow, double dltotal){
    if(dltotal>0){
        ui->progressBar1->setValue(static_cast<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>int</span><span class="token punctuation">></span></span>((dlnow/dltotal)*100));
    }
}

void MainWindow::onPushButton1Clicked(){
    ui->progressBar1->setValue(0);
    ui->label1->setText("");
//    downloader.startDownload("ftp://192.168.157.133:21/Wireshark-win32-2.6.3.rar","./myoutpu2t/","aaaWireshark-win32-2.6.3.rar");
    QStringList urls;
    urls.append("ftp://192.168.157.133:21/VC++RunTime2022.01.23.rar");
    urls.append("ftp://192.168.157.133:21/Merge Modules.rar");
    urls.append("ftp://192.168.157.133:21/Wireshark-win32-2.6.3.rar");

    for(int i=0;i&lt;urls.size();i++){
        QFileInfo fileInfo(urls[i]);
        downloader.startDownload(urls[i],"./myout/",fileInfo.fileName());
    }
}
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="mainwindow-ui"><a href="#mainwindow-ui" class="headerlink" title="mainwindow.ui"></a>mainwindow.ui</h3><pre class="line-numbers language-html"><code class="language-html"><span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8"?></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ui</span> <span class="token attr-name">version</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>4.0<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>class</span><span class="token punctuation">></span></span>MainWindow<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>class</span><span class="token punctuation">></span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>widget</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>QMainWindow<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>MainWindow<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>geometry<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>rect</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>x</span><span class="token punctuation">></span></span>0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>x</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>y</span><span class="token punctuation">></span></span>0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>y</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>width</span><span class="token punctuation">></span></span>400<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>width</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>height</span><span class="token punctuation">></span></span>300<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>height</span><span class="token punctuation">></span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>rect</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>windowTitle<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>string</span><span class="token punctuation">></span></span>MainWindow<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>string</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>widget</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>QWidget<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>centralWidget<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>widget</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>QPushButton<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>pushButton1<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>geometry<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>rect</span><span class="token punctuation">></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>x</span><span class="token punctuation">></span></span>50<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>x</span><span class="token punctuation">></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>y</span><span class="token punctuation">></span></span>120<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>y</span><span class="token punctuation">></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>width</span><span class="token punctuation">></span></span>75<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>width</span><span class="token punctuation">></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>height</span><span class="token punctuation">></span></span>23<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>height</span><span class="token punctuation">></span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>rect</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>string</span><span class="token punctuation">></span></span>PushButton<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>string</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">></span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>widget</span><span class="token punctuation">></span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>widget</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>QLabel<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>label1<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>geometry<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>rect</span><span class="token punctuation">></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>x</span><span class="token punctuation">></span></span>180<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>x</span><span class="token punctuation">></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>y</span><span class="token punctuation">></span></span>120<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>y</span><span class="token punctuation">></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>width</span><span class="token punctuation">></span></span>181<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>width</span><span class="token punctuation">></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>height</span><span class="token punctuation">></span></span>16<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>height</span><span class="token punctuation">></span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>rect</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>string</span><span class="token punctuation">></span></span>TextLabel<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>string</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">></span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>widget</span><span class="token punctuation">></span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>widget</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>QProgressBar<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>progressBar1<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>geometry<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>rect</span><span class="token punctuation">></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>x</span><span class="token punctuation">></span></span>90<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>x</span><span class="token punctuation">></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>y</span><span class="token punctuation">></span></span>40<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>y</span><span class="token punctuation">></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>width</span><span class="token punctuation">></span></span>118<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>width</span><span class="token punctuation">></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>height</span><span class="token punctuation">></span></span>23<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>height</span><span class="token punctuation">></span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>rect</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>value<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>number</span><span class="token punctuation">></span></span>24<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>number</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">></span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>widget</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>widget</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>widget</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>QMenuBar<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>menuBar<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>geometry<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>rect</span><span class="token punctuation">></span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>x</span><span class="token punctuation">></span></span>0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>x</span><span class="token punctuation">></span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>y</span><span class="token punctuation">></span></span>0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>y</span><span class="token punctuation">></span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>width</span><span class="token punctuation">></span></span>400<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>width</span><span class="token punctuation">></span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>height</span><span class="token punctuation">></span></span>23<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>height</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>rect</span><span class="token punctuation">></span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>widget</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>widget</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>QToolBar<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>mainToolBar<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>attribute</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>toolBarArea<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>enum</span><span class="token punctuation">></span></span>TopToolBarArea<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>enum</span><span class="token punctuation">></span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>attribute</span><span class="token punctuation">></span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>attribute</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>toolBarBreak<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bool</span><span class="token punctuation">></span></span>false<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bool</span><span class="token punctuation">></span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>attribute</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>widget</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>widget</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>QStatusBar<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>statusBar<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>widget</span><span class="token punctuation">></span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>layoutdefault</span> <span class="token attr-name">spacing</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>6<span class="token punctuation">"</span></span> <span class="token attr-name">margin</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>11<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>resources</span><span class="token punctuation">/></span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>connections</span><span class="token punctuation">/></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ui</span><span class="token punctuation">></span></span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="main-cpp-1"><a href="#main-cpp-1" class="headerlink" title="main.cpp"></a>main.cpp</h3><pre class="line-numbers language-html"><code class="language-html">#include "mainwindow.h"
#include <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>QApplication</span><span class="token punctuation">></span></span>
int main(int argc, char *argv[])
{
    QApplication a(argc, argv);
    MainWindow w;
    w.show();
    return a.exec();
}
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="命令行调用libcurl下载ftp文件示例"><a href="#命令行调用libcurl下载ftp文件示例" class="headerlink" title="命令行调用libcurl下载ftp文件示例"></a>命令行调用libcurl下载ftp文件示例</h2><pre class="line-numbers language-html"><code class="language-html">INCLUDEPATH += E:/Download/curl_8.5.0_5_win32_mingw/include
LIBS += E:/Download/curl_8.5.0_5_win32_mingw/lib/lib*.a  

#include <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>iostream</span><span class="token punctuation">></span></span>
#include &lt;curl/curl.h>
#include &lt;curl/easy.h>
#include <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>fstream</span><span class="token punctuation">></span></span>
#include <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>string</span><span class="token punctuation">></span></span>
#include <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>iomanip</span><span class="token punctuation">></span></span>


// 下载文件的回调函数，用于写入下载的数据
size_t write_data(void *ptr, size_t size, size_t nmemb, FILE *stream) {
    size_t written;
    written = fwrite(ptr, size, nmemb, stream);
    if(written &lt;=0){
        printf("nothing written!!");
    }
    return written;
}

void GetFtpFile(){
    CURL* curl;
    FILE* fp;
    CURLcode res;
    char* url="ftp://192.168.157.133/abcd.txt";
    char* outfilename="./ftpfile.txt";
    char* userpwd="abc:123456";
    curl_global_init(CURL_GLOBAL_DEFAULT);
    curl = curl_easy_init();
    if(curl){
        fp=fopen(outfilename,"wb");
        if(!fp){
            printf("can not open file");
            return;
        }
        curl_easy_setopt(curl, CURLOPT_URL, url);
        curl_easy_setopt(curl, CURLOPT_WRITEFUNCTION, write_data);
        curl_easy_setopt(curl, CURLOPT_WRITEDATA, fp);
        curl_easy_setopt(curl, CURLOPT_USERPWD, userpwd); // 设置用户名和密码
        curl_easy_setopt(curl, CURLOPT_VERBOSE, 0L); // 如果你想要详细的执行过程信息，可以启用这个选项 1l输出详细信息 0L不输出
        res = curl_easy_perform(curl);
        if (res != CURLE_OK)
        {
            std::cout &lt;&lt; "Failed to download file: " &lt;&lt; curl_easy_strerror(res) &lt;&lt; std::endl;
        }
        fclose(fp);
        curl_easy_cleanup(curl);
    }
    curl_global_cleanup();
}


int main(int argc, char* argv[])
{
    if(argc &lt; 2){
        std::cout &lt;&lt; "Please provide an argument." &lt;&lt; std::endl;
        return 1;
    }
    std::string argument = argv[1];
    if(argument == "ftpdownload"){
        GetFtpFile();
    } else {
        std::cout &lt;&lt; "Invalid argument." &lt;&lt; std::endl;
    }
    return 0;

}
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="libcurl以sftp获取目录下文件列表"><a href="#libcurl以sftp获取目录下文件列表" class="headerlink" title="libcurl以sftp获取目录下文件列表"></a>libcurl以sftp获取目录下文件列表</h2><pre class="line-numbers language-html"><code class="language-html">struct sftpFileInfo {
    std::string filename;
    std::string date0;
    std::string date1;
    std::string modifyTime;
};
size_t sftp_getdir_callback(void *ptr, size_t size, size_t nmemb, void *userdata) {
    std::vector<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>sftpFileInfo</span><span class="token punctuation">></span></span>* fileinfoInner = ( std::vector<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>sftpFileInfo</span><span class="token punctuation">></span></span>*)userdata;
    struct sftpFileInfo fileinfo;
//    printf("%.*s", (int)(size * nmemb), (char *)ptr);
    char *data = (char *)ptr;
    char filename[256];
    char modify_time[64];
    char modify_date0[32];
    char modify_date1[32];
    if (sscanf(data, "%*s %*s %*s %*s %*s %s %s %s %s",modify_date0, modify_date1, modify_time, filename) == 4) {
        if(strcmp(filename,".")!=0 &amp;&amp; strcmp(filename,"..")!=0){
          fileinfo.filename=filename;
          fileinfo.date0=modify_date0;
          fileinfo.date1=modify_date1;
          fileinfo.modifyTime=modify_time;
          fileinfoInner->push_back(fileinfo);
        }
    }
    return size * nmemb;
}
// 根据sftp协议获取指定目录下的文件列表
void testsftp(){
    CURL* curl;
    CURLcode res;
    std::vector<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>sftpFileInfo</span><span class="token punctuation">></span></span> abclist;
    char* userpwd="abc:123456";
    res = curl_global_init(CURL_GLOBAL_ALL);
    curl = curl_easy_init();
    if(curl){
        curl_easy_setopt(curl, CURLOPT_URL, "sftp://abc:123456@192.168.157.1:22/");
        curl_easy_setopt(curl, CURLOPT_CUSTOMREQUEST, "LIST");
        curl_easy_setopt(curl, CURLOPT_WRITEFUNCTION, sftp_getdir_callback);
        curl_easy_setopt(curl, CURLOPT_WRITEDATA, &amp;(abclist));

        res = curl_easy_perform(curl);
        if (res != CURLE_OK)
        {
            std::cout &lt;&lt; "Failed to get sftp dir " &lt;&lt; curl_easy_strerror(res) &lt;&lt; std::endl;
        }
        curl_easy_cleanup(curl);
    }
    curl_global_cleanup();

    for(int i=0;i&lt;abclist.size();i++){
        std::cout &lt;&lt;" get fileinfo : "&lt;&lt; abclist[i].filename &lt;&lt; " modify :" &lt;&lt;  abclist[i].date0 &lt;&lt;" " &lt;&lt; abclist[i].date1  &lt;&lt;" " &lt;&lt; abclist[i].modifyTime &lt;&lt; std::endl;
    }

}

// 之前下载ftp的列表，其实只要更换url能直接下载sftp文件
void downloadSFTP(){

    CURL* curl;
    FILE* fp;
    CURLcode res;
    char* url="sftp://abc:123456@192.168.157.1:22/666.txt";

    char* outfilename="./sftpfile.txt";
    char* userpwd="abc:123456";
    curl_global_init(CURL_GLOBAL_DEFAULT);
    curl = curl_easy_init();
    if(curl){
        fp=fopen(outfilename,"wb");
        if(!fp){
            printf("can not open file");
            return;
        }

        curl_easy_setopt(curl, CURLOPT_URL, url);
        curl_easy_setopt(curl, CURLOPT_WRITEFUNCTION, write_data);
        curl_easy_setopt(curl, CURLOPT_WRITEDATA, fp);

        curl_easy_setopt(curl, CURLOPT_NOPROGRESS,0L);
        curl_easy_setopt(curl, CURLOPT_PROGRESSFUNCTION,my_progress_func);
        curl_easy_setopt(curl, CURLOPT_PROGRESSDATA,curl);

        curl_easy_setopt(curl, CURLOPT_USERPWD, userpwd); // 设置用户名和密码
        curl_easy_setopt(curl, CURLOPT_VERBOSE, 0L); // 如果你想要详细的执行过程信息，可以启用这个选项 1l输出详细信息 0L不输出

        res = curl_easy_perform(curl);
        if (res != CURLE_OK)
        {
            std::cout &lt;&lt; "Failed to download file: " &lt;&lt; curl_easy_strerror(res) &lt;&lt; std::endl;
        }
        fclose(fp);
        curl_easy_cleanup(curl);
    }
    curl_global_cleanup();
}
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="win-优化版-通过libcurl批量下载实践"><a href="#win-优化版-通过libcurl批量下载实践" class="headerlink" title="win(优化版)通过libcurl批量下载实践"></a>win(优化版)通过libcurl批量下载实践</h2><blockquote>
<p>准备好./../3rd/curl_8.5.0_5_win32_mingw/<br>.pro里添加<br>INCLUDEPATH += $$PWD/../3rd/curl_8.5.0_5_win32_mingw/include<br>LIBS += $$PWD/../3rd/curl_8.5.0_5_win32_mingw/lib/lib<em>.a<br>添加新文件 -&gt; C++ -&gt; C++Class -&gt; Class name: DownloadThread<br>界面添加progressBar1,用于显示下载进度条<br>界面添加pushButton1，点击开始下载<br>界面添加pushButton_clear_log，点击清理log显示<br>界面添加lineEdit_saveSubPath，用于输入保存文件的子目录名<br>界面添加lineEdit_namepass，用于输入ftp的用户名密码<br>界面添加textEdit_urls，用于输入欲下载文件的完整ftpUrl，多个文件以换行连接<br>界面添加textEdit_log，用于显示当前动作的log信息<br>把./../3rd/curl_8.5.0_5_win32_mingw/bin/下”curl.exe curl-ca-bundle.crt libcurl.def libcurl.dll”4个文件复制一份到目标编译位置 *</em>/release/ 下<br>注意Ftp的ip地址、端口号、访问账号和密码填写正确  </p>
</blockquote>
<h3 id="项目-pro"><a href="#项目-pro" class="headerlink" title="项目.pro"></a>项目.pro</h3><pre class="line-numbers language-html"><code class="language-html">QT       += core gui
greaterThan(QT_MAJOR_VERSION, 4): QT += widgets
TARGET = arrdownload
TEMPLATE = app

INCLUDEPATH += $$PWD/../3rd/curl_8.5.0_5_win32_mingw/include
LIBS += $$PWD/../3rd/curl_8.5.0_5_win32_mingw/lib/lib*.a

SOURCES += main.cpp\
        mainwindow.cpp \
    downloadthread.cpp

HEADERS  += mainwindow.h \
    downloadthread.h

FORMS    += mainwindow.ui
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="自定义下载类DownloadThread"><a href="#自定义下载类DownloadThread" class="headerlink" title="自定义下载类DownloadThread"></a>自定义下载类DownloadThread</h3><p>downloadthread.h  </p>
<pre class="line-numbers language-html"><code class="language-html">#ifndef DOWNLOADTHREAD_H
#define DOWNLOADTHREAD_H

#include <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>QObject</span><span class="token punctuation">></span></span>
#include <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>QThread</span><span class="token punctuation">></span></span>
#include &lt;curl/curl.h>
#include <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>iostream</span><span class="token punctuation">></span></span>
#include <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>QThread</span><span class="token punctuation">></span></span>
#include <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>QApplication</span><span class="token punctuation">></span></span>

#include <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>QDir</span><span class="token punctuation">></span></span>
#include <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>string</span><span class="token punctuation">></span></span>
#include <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>QMutex</span><span class="token punctuation">></span></span>
#include <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>QDebug</span><span class="token punctuation">></span></span>
class DownloadThread : public QThread
{
    Q_OBJECT
public:
    DownloadThread(const QStringList&amp; urls, const QString&amp; saveDir, const QString&amp; userPass, QObject *parent = 0):QThread(parent),urls(urls),saveDir(saveDir),userPass(userPass){
    }
    void run()override{
        downloadedNum=0;
        qDebug()&lt;&lt;"start run";
        for(int i=0;i&lt;urls.length();i++){
            startDownload(urls[i],saveDir);
            if(allFilesDownloaded()){
                emit downloadMutliFinished();
                emit allDownloadsFinished();
                break;
            }
        }
    }

signals:
    void allDownloadsFinished();
    void downloadProgress(double dlnow, double dltotal);
    void downloadFinished(bool success);
    void downloadMutliFinished();
    void downloadLog(std::string fname);
public slots:

private:
    QString nowfilename;
    int downloadedNum;
    QMutex mutex;
    QStringList urls;
    QString saveDir;
    QString userPass;
    void startDownload(const QString&amp; url, const QString&amp; saveDir)
    {
        // 执行下载逻辑
        QFileInfo fileInfo(url);
        nowfilename=fileInfo.fileName();
        emit downloadLog("start downloading "+nowfilename.toStdString());
        performDownload(std::string(url.toStdString().c_str()), saveDir, fileInfo.fileName());
    }

    bool allFilesDownloaded()
    {

        // 检查是否所有文件已经下载完成的逻辑
        // 返回 true 表示全部文件已下载完成，否则返回 false
        if(downloadedNum>=urls.count()){
            return true;
        }else{
            return false;
        }
    }
    // 下载文件的回调函数，用于写入下载的数据
        static size_t write_data(void *ptr, size_t size, size_t nmemb, FILE *stream){
            size_t written;
            written = fwrite(ptr, size, nmemb, stream);
            if(written &lt;=0){
                printf("nothing written!!");
            }
            return written;
        }
        // 下载文件进度的回调函数
        static int progressCallBack(void* progress_data,double dltotal, double dlnow, double ultotal,double ulnow){
            DownloadThread *downloader=static_cast<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>DownloadThread*</span><span class="token punctuation">></span></span>(progress_data);
            emit downloader->downloadProgress(dlnow,dltotal);
            return 0;
        }
        // 请求字符转义，目前只处理空格
        std::string encodeSpecialCharacters(const std::string&amp; input){
            std::string result;
            for(int i=0;i&lt;input.length();i++){
                switch (input[i]) {
                    case ' ':
                        result += "%20";
                        break;
    //                case '!':
    //                    result += "%21";
    //                    break;
    //                case '#':
    //                    result += "%23";
    //                    break;
    //                case '$':
    //                    result += "%24";
    //                    break;
    //                case '&amp;':
    //                    result += "%26";
    //                    break;
    //                case '\'':
    //                    result += "%27";
    //                    break;
    //                case '(':
    //                    result += "%28";
    //                    break;
    //                case ')':
    //                    result += "%29";
    //                    break;
    //                case '*':
    //                    result += "%2A";
    //                    break;
    //                case '+':
    //                    result += "%2B";
    //                    break;
    //                case ',':
    //                    result += "%2C";
    //                    break;
    //                case '/':
    //                    result += "%2F";
    //                    break;
    //                case ':':
    //                    result += "%3A";
    //                    break;
    //                case ';':
    //                    result += "%3B";
    //                    break;
    //                case '=':
    //                    result += "%3D";
    //                    break;
    //                case '?':
    //                    result += "%3F";
    //                    break;
    //                case '@':
    //                    result += "%40";
    //                    break;
    //                case '[':
    //                    result += "%5B";
    //                    break;
    //                case ']':
    //                    result += "%5D";
    //                    break;
                    default:
                        result += input[i];
                        break;
                }
            }
            return result;
        }
        int performDownload(const std::string&amp; url, const QString&amp; saveFileDir, const QString&amp; saveFileName){
            int ret=-1;
            CURL* curl;
            FILE* fp;
            CURLcode res;
            QDir dir;
            if(!dir.exists(saveFileDir)){
                dir.mkpath(saveFileDir);
            }
            char* userpwd=strdup(userPass.toUtf8().data());// "abc:123456";   // FTP账号名:FTP密码
            curl_global_init(CURL_GLOBAL_ALL);
            curl = curl_easy_init();
            if(curl){
                const QString saveFileUrl = saveFileDir + saveFileName;
                const char* outfilename= saveFileUrl.toLocal8Bit().constData(); //"newoutput/" + "ftpfile.txt";
                fp=fopen(outfilename,"wb");
                if(!fp){
                    std::string str(outfilename);
                    emit downloadLog("can not open file "+str);
                    printf("can not open file");
                    return ret;
                }

                std::string encodedString = encodeSpecialCharacters(url);
                curl_easy_setopt(curl, CURLOPT_URL, encodedString.c_str());
    //            curl_easy_setopt(curl, CURLOPT_URL, url.c_str());
                curl_easy_setopt(curl, CURLOPT_WRITEFUNCTION, write_data);
                curl_easy_setopt(curl, CURLOPT_WRITEDATA, fp);
                curl_easy_setopt(curl, CURLOPT_NOPROGRESS,0L);
                curl_easy_setopt(curl, CURLOPT_PROGRESSFUNCTION, &amp;DownloadThread::progressCallBack);
                curl_easy_setopt(curl, CURLOPT_PROGRESSDATA,this);
                curl_easy_setopt(curl, CURLOPT_TRANSFERTEXT, 0);
                curl_easy_setopt(curl, CURLOPT_USERPWD, userpwd); // 设置用户名和密码
                curl_easy_setopt(curl, CURLOPT_VERBOSE, 0L); // 如果你想要详细的执行过程信息，可以启用这个选项 1l输出详细信息 0L不输出
//                // 加锁
                mutex.lock();
                res = curl_easy_perform(curl);
                if (res != CURLE_OK)
                {
                    emit downloadFinished(false);
                    emit downloadLog("failed downloaded "+nowfilename.toStdString());
                }else{
                    emit downloadFinished(true);
                    ret = 0;
                    emit downloadLog("success downloaded "+nowfilename.toStdString());
                    downloadedNum++;
                }
                // 解锁
                mutex.unlock();
                fclose(fp);
                curl_easy_cleanup(curl);
            }
            curl_global_cleanup();
            return ret;
        }
};
#endif // DOWNLOADTHREAD_H
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>downloadthread.cpp  </p>
<pre class="line-numbers language-html"><code class="language-html">#include "downloadthread.h"
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h3 id="mainwindow-1"><a href="#mainwindow-1" class="headerlink" title="mainwindow"></a>mainwindow</h3><p>mainwindow.h  </p>
<pre class="line-numbers language-html"><code class="language-html">#ifndef MAINWINDOW_H
#define MAINWINDOW_H

#include <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>QMainWindow</span><span class="token punctuation">></span></span>
#include "downloadthread.h"
#include <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>QDebug</span><span class="token punctuation">></span></span>
#include <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>QMetaType</span><span class="token punctuation">></span></span>
namespace Ui {
class MainWindow;
}

class MainWindow : public QMainWindow
{
    Q_OBJECT

public:
    explicit MainWindow(QWidget *parent = 0);
    ~MainWindow();

private:
    Ui::MainWindow *ui;

public slots:
    void onPushButton1Clicked();
    void onUpdateDownloaderProgress(double dlnow, double dltotal);
    void onDownloadLog(std::string fname);
};

#endif // MAINWINDOW_H
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>mainwindow.cpp  </p>
<pre class="line-numbers language-html"><code class="language-html">#include "mainwindow.h"
#include "ui_mainwindow.h"

MainWindow::MainWindow(QWidget *parent) :
    QMainWindow(parent),
    ui(new Ui::MainWindow)
{
    qRegisterMetaType<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">std:</span>:string</span><span class="token punctuation">></span></span>("std::string");
    ui->setupUi(this);
    setWindowTitle("FTP tools");

    QString url1="ftp://192.168.157.146:21/VC__RunTime2022.01.23.rar";
    QString url2="ftp://192.168.157.146:21/Merge Modules.rar";
    QString url3="ftp://192.168.157.146:21/Wireshark-win32-2.6.3.rar";
    ui->textEdit_urls->setText(url1+"\n"+url2+"\n"+url3);
    ui->textEdit_log->setReadOnly(true);
    ui->lineEdit_saveSubPath->setText("subdir");
    ui->lineEdit_namepass->setText("abc:123456");

    connect(ui->pushButton1,SIGNAL(clicked()),this,SLOT(onPushButton1Clicked()));
    connect(ui->pushButton_clear_log,&amp;QPushButton::clicked,[=](){
       ui->textEdit_log->setText("");
    });
}

MainWindow::~MainWindow()
{
    delete ui;
}

void MainWindow::onUpdateDownloaderProgress(double dlnow, double dltotal){
    if(dltotal>0){
        ui->progressBar1->setValue(static_cast<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>int</span><span class="token punctuation">></span></span>((dlnow/dltotal)*100));
    }
}
void MainWindow::onDownloadLog(std::string fname){
    ui->textEdit_log->append(QString::fromStdString(fname));
}

void MainWindow::onPushButton1Clicked(){
    ui->progressBar1->setValue(0);
    QStringList urls = ui->textEdit_urls->toPlainText().split('\n');
    DownloadThread* downloadThread=new DownloadThread(urls,ui->lineEdit_saveSubPath->text()+"/",ui->lineEdit_namepass->text());
    connect(downloadThread, &amp;DownloadThread::allDownloadsFinished, downloadThread, &amp;DownloadThread::quit);
    connect(downloadThread, &amp;DownloadThread::finished, downloadThread, &amp;DownloadThread::deleteLater);
    connect(downloadThread, &amp;DownloadThread::downloadLog,this,&amp;MainWindow::onDownloadLog);
    connect(downloadThread, &amp;DownloadThread::downloadProgress,this,&amp;MainWindow::onUpdateDownloaderProgress);
    connect(downloadThread, &amp;DownloadThread::downloadMutliFinished,[&amp;](){
            onDownloadLog("### All Tasks Compeleted Success ### ");
        });
    connect(downloadThread, &amp;DownloadThread::downloadFinished,[&amp;](bool success){
//           if(success){
//                ui->label1->setText("download success");
//           }else{
//                ui->label1->setText("download failed");
//           }
        });
    downloadThread->start();
    qDebug()&lt;&lt;"start";

}
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="mainwindow-ui-1"><a href="#mainwindow-ui-1" class="headerlink" title="mainwindow.ui"></a>mainwindow.ui</h3><pre class="line-numbers language-html"><code class="language-html"><span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8"?></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ui</span> <span class="token attr-name">version</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>4.0<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>class</span><span class="token punctuation">></span></span>MainWindow<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>class</span><span class="token punctuation">></span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>widget</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>QMainWindow<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>MainWindow<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>geometry<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>rect</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>x</span><span class="token punctuation">></span></span>0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>x</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>y</span><span class="token punctuation">></span></span>0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>y</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>width</span><span class="token punctuation">></span></span>400<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>width</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>height</span><span class="token punctuation">></span></span>300<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>height</span><span class="token punctuation">></span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>rect</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>windowTitle<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>string</span><span class="token punctuation">></span></span>MainWindow<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>string</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>widget</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>QWidget<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>centralWidget<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>layout</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>QVBoxLayout<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>verticalLayout<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>item</span><span class="token punctuation">></span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>layout</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>QHBoxLayout<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>horizontalLayout_2<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>item</span><span class="token punctuation">></span></span>
       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>widget</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>QProgressBar<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>progressBar1<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>value<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>number</span><span class="token punctuation">></span></span>24<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>number</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">></span></span>
       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>widget</span><span class="token punctuation">></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>item</span><span class="token punctuation">></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>item</span><span class="token punctuation">></span></span>
       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>widget</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>QPushButton<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>pushButton1<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>string</span><span class="token punctuation">></span></span>download<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>string</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">></span></span>
       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>widget</span><span class="token punctuation">></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>item</span><span class="token punctuation">></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>item</span><span class="token punctuation">></span></span>
       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>widget</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>QPushButton<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>pushButton_clear_log<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>string</span><span class="token punctuation">></span></span>clearLog<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>string</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">></span></span>
       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>widget</span><span class="token punctuation">></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>item</span><span class="token punctuation">></span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>layout</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>item</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>item</span><span class="token punctuation">></span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>layout</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>QHBoxLayout<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>horizontalLayout<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>item</span><span class="token punctuation">></span></span>
       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>widget</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>QLabel<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>label<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>string</span><span class="token punctuation">></span></span>saveSubDir:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>string</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">></span></span>
       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>widget</span><span class="token punctuation">></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>item</span><span class="token punctuation">></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>item</span><span class="token punctuation">></span></span>
       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>widget</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>QLineEdit<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>lineEdit_saveSubPath<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>item</span><span class="token punctuation">></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>item</span><span class="token punctuation">></span></span>
       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>widget</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>QLabel<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>label_2<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>string</span><span class="token punctuation">></span></span>user:pass<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>string</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">></span></span>
       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>widget</span><span class="token punctuation">></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>item</span><span class="token punctuation">></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>item</span><span class="token punctuation">></span></span>
       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>widget</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>QLineEdit<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>lineEdit_namepass<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>item</span><span class="token punctuation">></span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>layout</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>item</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>item</span><span class="token punctuation">></span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>widget</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>QTextEdit<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>textEdit_urls<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>item</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>item</span><span class="token punctuation">></span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>widget</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>QTextEdit<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>textEdit_log<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>item</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>item</span><span class="token punctuation">></span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>spacer</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>verticalSpacer<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>orientation<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>enum</span><span class="token punctuation">></span></span>Qt::Vertical<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>enum</span><span class="token punctuation">></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>sizeHint<span class="token punctuation">"</span></span> <span class="token attr-name">stdset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>0<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>size</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>width</span><span class="token punctuation">></span></span>20<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>width</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>height</span><span class="token punctuation">></span></span>40<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>height</span><span class="token punctuation">></span></span>
       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>size</span><span class="token punctuation">></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">></span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>spacer</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>item</span><span class="token punctuation">></span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>layout</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>widget</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>widget</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>QMenuBar<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>menuBar<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>geometry<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>rect</span><span class="token punctuation">></span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>x</span><span class="token punctuation">></span></span>0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>x</span><span class="token punctuation">></span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>y</span><span class="token punctuation">></span></span>0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>y</span><span class="token punctuation">></span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>width</span><span class="token punctuation">></span></span>400<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>width</span><span class="token punctuation">></span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>height</span><span class="token punctuation">></span></span>23<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>height</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>rect</span><span class="token punctuation">></span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>widget</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>widget</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>QToolBar<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>mainToolBar<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>attribute</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>toolBarArea<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>enum</span><span class="token punctuation">></span></span>TopToolBarArea<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>enum</span><span class="token punctuation">></span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>attribute</span><span class="token punctuation">></span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>attribute</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>toolBarBreak<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bool</span><span class="token punctuation">></span></span>false<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bool</span><span class="token punctuation">></span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>attribute</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>widget</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>widget</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>QStatusBar<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>statusBar<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>widget</span><span class="token punctuation">></span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>layoutdefault</span> <span class="token attr-name">spacing</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>6<span class="token punctuation">"</span></span> <span class="token attr-name">margin</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>11<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>resources</span><span class="token punctuation">/></span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>connections</span><span class="token punctuation">/></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ui</span><span class="token punctuation">></span></span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="main-cpp-2"><a href="#main-cpp-2" class="headerlink" title="main.cpp"></a>main.cpp</h3><pre class="line-numbers language-html"><code class="language-html">#include "mainwindow.h"
#include <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>QApplication</span><span class="token punctuation">></span></span>
int main(int argc, char *argv[])
{
    QApplication a(argc, argv);
    MainWindow w;
    w.show();
    return a.exec();
}
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="win10自带文件md5校验"><a href="#win10自带文件md5校验" class="headerlink" title="win10自带文件md5校验"></a>win10自带文件md5校验</h2><p>Windows(Win10)自带的用于文件校验(Hash校验,SHA256校验,MD5校验等)的命令: certutil和Get-FileHash  </p>
<pre class="line-numbers language-html"><code class="language-html">CertUtil可以在cmd和powershell中运行
Get-FileHash 是powershell的命令,不能在cmd命令行运行  

CertUtil支持的算法'MD2, MD4, MD5, SHA1, SHA256, SHA384, SHA512'
也可以小写为 'md2, md4, md5, sha1, sha256, sha384, sha512'  

Get-FileHash支持的算法"SHA1, SHA256, SHA384,  SHA512, MACTripleDES, MD5, RIPEMD160"  
也可以小写为"sha1, sha256, sha384,  sha512, mactripledes, md5, ripemd160"  

文件路径比如为 F:\Desktop\boo\test\abc.txt
CertUtil -hashfile F:\Desktop\boo\test\abc.txt SHA256 > ./res.txt  
Get-FileHash F:\Desktop\boo\test\abc.txt -Algorithm SHA256
certutil -hashfile F:\Desktop\boo\test\abc.txt MD5
Get-FileHash F:\Desktop\boo\test\abc.txt -Algorithm MD5
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="适配器用于将字节数组（byte-）转换为特定内容"><a href="#适配器用于将字节数组（byte-）转换为特定内容" class="headerlink" title="适配器用于将字节数组（byte[]）转换为特定内容"></a>适配器用于将字节数组（byte[]）转换为特定内容</h2><pre class="line-numbers language-html"><code class="language-html">#include <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>iostream</span><span class="token punctuation">></span></span>

std::string byteArrAdapter(const byte* arr, size_t size) {
    std::string result;

    // 根据字节数组的内容进行转换或改造
    // 这里只是一个示例，您可以根据具体需求进行修改

    for (size_t i = 0; i &lt; size; i++) {
        // 将每个字节转换为对应字符并连接到结果字符串中
        result += static_cast<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>char</span><span class="token punctuation">></span></span>(arr[i]);
    }

    return result;
}

int main() {
    // 示例字节数组
    byte arr[] = {72, 101, 108, 108, 111, 32, 87, 111, 114, 108, 100};

    // 调用适配器函数将字节数组转换为字符串
    std::string adaptedContent = byteArrAdapter(arr, sizeof(arr));

    // 输出转换后的内容
    std::cout &lt;&lt; "Adapted Content: " &lt;&lt; adaptedContent &lt;&lt; std::endl;

    return 0;
}
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
            </div>
            <hr/>

            

            <link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css">

<div id="article-share">
    
    <div class="social-share" data-disabled="qzone" data-wechat-qrcode-helper="<p>微信里点“发现”->“扫一扫”二维码便可查看分享。</p>"></div>
    
</div>

<script src="/libs/share/js/social-share.min.js"></script>

            
            
            
            <div class="reprint1">
                <p>
                    <span class="reprint1-tip">
                        <i class="fa fa-exclamation-circle"></i>&nbsp;&nbsp;转载请注明:
                    </span>
                    <a href="http://127.0.0.1/diary" class="b-link-green">车舟慢</a>
                    <i class="fa fa-angle-right fa-lg fa-fw text-color"></i>
                    <a href="/diary/2023/11/17/diary-20231117-1/" class="b-link-green">VS的C/C++开发和MFC</a>
                </p>
            </div>

        </div>
    </div>

    

    

    

    

    
        <style>
    .valine-card {
        margin: 1.5rem auto;
    }

    .valine-card .card-content {
        padding: 20px 20px 5px 20px;
    }
	
	/*zs shuai*/
	#vcomments{
		display:none;
	}
	
    /* valine 评论框增加背景图片 */
    #vcomments textarea {
        box-sizing: border-box;
        background: url("") 100% 100% no-repeat;
    }

    #vcomments input[type=text],
    #vcomments input[type=email],
    #vcomments input[type=url],
    #vcomments textarea {
        box-sizing: border-box;
    }

    #vcomments p {
        margin: 2px 2px 10px;
        font-size: 1.05rem;
        line-height: 1.78rem;
    }

    #vcomments blockquote p {
        text-indent: 0.2rem;
    }

    #vcomments a {
        padding: 0 2px;
        color: #42b983;
        font-weight: 500;
        text-decoration: underline;
    }

    #vcomments img {
        max-width: 100%;
        height: auto;
        cursor: pointer;
    }

    #vcomments ol li {
        list-style-type: decimal;
    }

    #vcomments ol,
    ul {
        display: block;
        padding-left: 2em;
        word-spacing: 0.05rem;
    }

    #vcomments ul li,
    ol li {
        display: list-item;
        line-height: 1.8rem;
        font-size: 1rem;
    }

    #vcomments ul li {
        list-style-type: disc;
    }

    #vcomments ul ul li {
        list-style-type: circle;
    }

    #vcomments table, th, td {
        padding: 12px 13px;
        border: 1px solid #dfe2e5;
    }

    #vcomments table, th, td {
        border: 0;
    }

    table tr:nth-child(2n), thead {
        background-color: #fafafa;
    }

    #vcomments table th {
        background-color: #f2f2f2;
        min-width: 80px;
    }

    #vcomments table td {
        min-width: 80px;
    }

    #vcomments h1 {
        font-size: 1.85rem;
        font-weight: bold;
        line-height: 2.2rem;
    }

    #vcomments h2 {
        font-size: 1.65rem;
        font-weight: bold;
        line-height: 1.9rem;
    }

    #vcomments h3 {
        font-size: 1.45rem;
        font-weight: bold;
        line-height: 1.7rem;
    }

    #vcomments h4 {
        font-size: 1.25rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    #vcomments h5 {
        font-size: 1.1rem;
        font-weight: bold;
        line-height: 1.4rem;
    }

    #vcomments h6 {
        font-size: 1rem;
        line-height: 1.3rem;
    }

    #vcomments p {
        font-size: 1rem;
        line-height: 1.5rem;
    }

    #vcomments hr {
        margin: 12px 0;
        border: 0;
        border-top: 1px solid #ccc;
    }

    #vcomments blockquote {
        margin: 15px 0;
        border-left: 5px solid #42b983;
        padding: 1rem 0.8rem 0.3rem 0.8rem;
        color: #666;
        background-color: rgba(66, 185, 131, .1);
    }

    #vcomments pre {
        font-family: monospace, monospace;
        padding: 1.2em;
        margin: .5em 0;
        background: #272822;
        overflow: auto;
        border-radius: 0.3em;
        tab-size: 4;
    }

    #vcomments code {
        font-family: monospace, monospace;
        padding: 1px 3px;
        font-size: 0.92rem;
        color: #e96900;
        background-color: #f8f8f8;
        border-radius: 2px;
    }

    #vcomments pre code {
        font-family: monospace, monospace;
        padding: 0;
        color: #e8eaf6;
        background-color: #272822;
    }

    #vcomments pre[class*="language-"] {
        padding: 1.2em;
        margin: .5em 0;
    }

    #vcomments code[class*="language-"],
    pre[class*="language-"] {
        color: #e8eaf6;
    }

    #vcomments [type="checkbox"]:not(:checked), [type="checkbox"]:checked {
        position: inherit;
        margin-left: -1.3rem;
        margin-right: 0.4rem;
        margin-top: -1px;
        vertical-align: middle;
        left: unset;
        visibility: visible;
    }

    #vcomments b,
    strong {
        font-weight: bold;
    }

    #vcomments dfn {
        font-style: italic;
    }

    #vcomments small {
        font-size: 85%;
    }

    #vcomments cite {
        font-style: normal;
    }

    #vcomments mark {
        background-color: #fcf8e3;
        padding: .2em;
    }

    #vcomments table, th, td {
        padding: 12px 13px;
        border: 1px solid #dfe2e5;
    }

    table tr:nth-child(2n), thead {
        background-color: #fafafa;
    }

    #vcomments table th {
        background-color: #f2f2f2;
        min-width: 80px;
    }

    #vcomments table td {
        min-width: 80px;
    }

    #vcomments [type="checkbox"]:not(:checked), [type="checkbox"]:checked {
        position: inherit;
        margin-left: -1.3rem;
        margin-right: 0.4rem;
        margin-top: -1px;
        vertical-align: middle;
        left: unset;
        visibility: visible;
    }

    /* 修复评论第一行位置错位 */
    .v .vlist .vcard {
    padding-top: 2.5em !important ;
    }
</style>

<div class="card valine-card" data-aos="fade-up">
    <div id="vcomments" class="card-content"></div>
</div>

<script src="/libs/valine/av-min.js"></script>
<script src="/libs/valine/Valine.min.js"></script>
<!-- <link rel="stylesheet" type="text/css" href="/libs//libs/jQuery-emoji/dist/css/jquery.emoji.css">
<script src="/libs//libs/jQuery-emoji/dist/js/jquery.emoji.min.js"></script>
<script src="/libs//libs/jQuery-emoji/dist/js/emoji.list.js"></script> -->
<script>
    new Valine({
        el: '#vcomments',
        appId: '2Kc1yifl00dRA6CYQxICVIe4-MdYXbMMI',
        appKey: 'xni6ILbDL2WVE4HDucMuDtx7',
        notify: 'true' === 'true',
        verify: 'true' === 'true',
        visitor: 'true' === 'true',
        avatar: '',
        pageSize: '10',
        lang: 'zh-cn',
        placeholder: 'just go go ヾﾉ≧∀≦)o ',

    });

//     function parse_emoji() {
//     jQuery(".vcontent").emojiParse({
//       basePath: '/libs/jQuery-emoji/images/emoji',
//       icons: emojiLists   // 注：详见 js/emoji.list.js
//     });
//   }
  
//   setTimeout(function() {
//     // jQuery emoji 解析
//     parse_emoji();
//     // jquery emoji 初始化
//     jQuery(".veditor").emoji({
//       showTab: true,
//       animation: 'slide',
//       basePath: '/libs/jQuery-emoji/images/emoji',
//       icons: emojiLists  // 注：详见 js/emoji.list.js
//     });
//     jQuery(".vmore").on("click", function() {
//       setTimeout(function() {
//         parse_emoji();
//       }, 500);
//     });
//   }, 800)

</script>
    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="fa fa-chevron-left"></i>&nbsp;上一篇</div>
            <div class="card">
                <a href="/diary/2023/11/29/diary-20231129-1/">
                    <div class="card-image">
                        
                        
                        <img src="/diary/medias/featureimages/25.jpg" class="responsive-img" alt="VSCode的Python开发">
                        
                        <span class="card-title">VSCode的Python开发</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            vscode开发pythonvscode Extensions:MarketPlace 搜索安装"Python"  
新建文件test.py,内容如：print("hello vscode from Python")  
点击左侧Run a
                        
                    </div>
                    <div class="publish-info">
                        <span class="publish-date">
                            <i class="fa fa-clock-o fa-fw icon-date"></i>2023-11-29
                        </span>
                        <span class="publish-author">
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/diary/tags/Python/" target="_blank">
                        <span class="chip bg-color">Python</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                下一篇&nbsp;<i class="fa fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/diary/2023/10/30/diary-20231030-1/">
                    <div class="card-image">
                        
                        
                        <img src="/diary/medias/featureimages/27.jpg" class="responsive-img" alt="AndroidStudio默认路径和离线编译">
                        
                        <span class="card-title">AndroidStudio默认路径和离线编译</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            Androidstuio修改默认gradle路径AndroidStudio每次新建项目，都会默认在C盘生成并下载gradle相关文件，由于C盘空间有限，没多久C盘就飘红了，于是就需要把gradle相关文件转移到其他盘  
1. 到C盘找到g
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="fa fa-clock-o fa-fw icon-date"></i>2023-10-30
                            </span>
                        <span class="publish-author">
                            
                        </span>
                    </div>
                </div>
                
            </div>
        </div>
        
    </div>
</article>
</div>


<script>
    $('#articleContent').on('copy', function (e) {
        // IE8 or earlier browser is 'undefined'
        if (typeof window.getSelection === 'undefined') return;

        var selection = window.getSelection();
        // if the selection is short let's not annoy our users.
        if (('' + selection).length < Number.parseInt('120')) {
            return;
        }

        // create a div outside of the visible area and fill it with the selected text.
        var bodyElement = document.getElementsByTagName('body')[0];
        var newdiv = document.createElement('div');
        newdiv.style.position = 'absolute';
        newdiv.style.left = '-99999px';
        bodyElement.appendChild(newdiv);
        newdiv.appendChild(selection.getRangeAt(0).cloneContents());

        // we need a <pre> tag workaround.
        // otherwise the text inside "pre" loses all the line breaks!
        if (selection.getRangeAt(0).commonAncestorContainer.nodeName === 'PRE') {
            newdiv.innerHTML = "<pre>" + newdiv.innerHTML + "</pre>";
        }

        var url = document.location.href;
        newdiv.innerHTML += '<br />'
            + '来源: 车舟慢<br />'
            + '作者: <br />'
            + '链接: <a href="' + url + '">' + url + '</a><br />'
            + '本文章著作权归作者所有，任何形式的转载都请注明出处。';

        selection.selectAllChildren(newdiv);
        window.setTimeout(function () {bodyElement.removeChild(newdiv);}, 200);
    });
</script>


    </div>
    <div id="toc-aside" class="expanded col l3 hide-on-med-and-down">
        <div class="toc-widget">
            <div class="toc-title"><i class="fa fa-list-alt"></i>&nbsp;&nbsp;目录</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<!-- TOC 悬浮按钮. -->

<div id="floating-toc-btn" class="hide-on-med-and-down">
    <a class="btn-floating btn-large bg-color">
        <i class="fa fa-list"></i>
    </a>
</div>


<script src="/diary/libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            // headingsOffset: -205,
            headingSelector: 'h1, h2, h3, h4, h5'
        });

        // modify the toc link href to support Chinese.
        let i = 0;
        let tocHeading = 'toc-heading-';
        $('#toc-content a').each(function () {
            $(this).attr('href', '#' + tocHeading + (++i));
        });

        // modify the heading title id to support Chinese.
        i = 0;
        $('#articleContent').children('h1, h2, h3, h4, h5').each(function () {
            $(this).attr('id', tocHeading + (++i));
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* 修复文章卡片 div 的宽度. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // 切换TOC目录展开收缩的相关操作.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).slideUp(500);
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).slideDown(500);
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });
</script>
    

</main>


        <footer class="page-footer bg-color">
    <div class="container row center-align">
        <div class="col s12 m8 l8 copy-right">
            

            <br>
            <span id="sitetime"></span><span class="my-face">ღゝ◡╹)ノ♡</span>
            <br>

            

            
            <!--
            
			
                &nbsp; | &nbsp;字数统计:&nbsp;
    <span class="white-color">650.5k</span> 字  
			
            
			
			-->

            
            <br>

        </div>

        <div class="col s12 m4 l4 social-link social-statis">

 
    <a href="https://mail.qq.com/cgi-bin/qm_share?t=qm_mailme&email=617641594@qq.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50">
        <i class="fa fa-envelope-open"></i>
    </a>






    <a href="http://wpa.qq.com/msgrd?v=3&uin=617641594&site=qq&menu=yes" class="tooltipped" target="_blank" data-tooltip="访问我的QQ空间" data-position="top" data-delay="50">
        <i class="fa fa-qq"></i>
    </a>




<!--

    <a href="/diary/atom.xml" class="tooltipped" target="_blank" data-tooltip="RSS 订阅" data-position="top" data-delay="50">
        <i class="fa fa-rss"></i>
    </a>

--></div>

    </div>
</footer>

<div class="progress-bar"></div>

<script language=javascript>
    function siteTime() {
        window.setTimeout("siteTime()", 1000);
        var seconds = 1000;
        var minutes = seconds * 60;
        var hours = minutes * 60;
        var days = hours * 24;
        var years = days * 365;
        var today = new Date();
        var todayYear = today.getFullYear();
        var todayMonth = today.getMonth() + 1;
        var todayDate = today.getDate();
        var todayHour = today.getHours();
        var todayMinute = today.getMinutes();
        var todaySecond = today.getSeconds();

        /* Date.UTC() -- 返回date对象距世界标准时间(UTC)1970年1月1日午夜之间的毫秒数(时间戳)
        year - 作为date对象的年份，为4位年份值
        month - 0-11之间的整数，做为date对象的月份
        day - 1-31之间的整数，做为date对象的天数
        hours - 0(午夜24点)-23之间的整数，做为date对象的小时数
        minutes - 0-59之间的整数，做为date对象的分钟数
        seconds - 0-59之间的整数，做为date对象的秒数
        microseconds - 0-999之间的整数，做为date对象的毫秒数 */

        var t1 = Date.UTC(2020, 5, 1, 00, 00, 00); //北京时间2019-8-1 00:00:00
        var t2 = Date.UTC(todayYear, todayMonth, todayDate, todayHour, todayMinute, todaySecond);
        var diff = t2 - t1;
        var diffYears = Math.floor(diff / years);
        var diffDays = Math.floor((diff / days) - diffYears * 365);
        var diffHours = Math.floor((diff - (diffYears * 365 + diffDays) * days) / hours);
        var diffMinutes = Math.floor((diff - (diffYears * 365 + diffDays) * days - diffHours * hours) / minutes);
        var diffSeconds = Math.floor((diff - (diffYears * 365 + diffDays) * days - diffHours * hours - diffMinutes *
            minutes) / seconds);
        document.getElementById("sitetime").innerHTML = "本站已坚持运行 " + diffYears + " 年 " + diffDays + " 天 " + diffHours +
            " 小时 " + diffMinutes + " 分钟 " + diffSeconds + " 秒" ;
    } /*因为建站时间还没有一年，就将之注释掉了。需要的可以取消*/
    siteTime();
</script>






        <!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fa fa-search"></i>&nbsp;&nbsp;搜索</span>
            <input type="search" id="searchInput" name="s" placeholder="请输入搜索的关键字"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>
<script src="/diary/js/search.js"></script>
<script type="text/javascript">
$(function () {
    searchFunc("/diary/" + "search.xml", 'searchInput', 'searchResult');
});
</script>
        <!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fa fa-angle-up"></i>
    </a>
</div>


        <script src="/diary/libs/materialize/materialize.min.js"></script>
        <script src="/diary/libs/masonry/masonry.pkgd.min.js"></script>
        <script src="/diary/libs/aos/aos.js"></script>
        <script src="/diary/libs/scrollprogress/scrollProgress.min.js"></script>
        <script src="/diary/libs/lightGallery/js/lightgallery-all.min.js"></script>
        <script src="/diary/js/matery.js"></script>

        <!-- Global site tag (gtag.js) - Google Analytics -->



        
            <script src="/diary/libs/others/clicklove.js"></script>
        

        

        
        <script type="text/javascript">
            var OriginTitile = document.title,
                st;
            document.addEventListener("visibilitychange", function () {
                document.hidden ? (document.title = "看不见我🙈~看不见我🙈~", clearTimeout(st)) : (document.title =
                    "(๑•̀ㅂ•́) ✧被发现了～", st = setTimeout(function () {
                        document.title = OriginTitile
                    }, 3e3))
            })
        </script>

       
        

        
        

    
        

    
        

        

        
        

        
        

        
        
            <script type="text/javascript">
            var windowWidth = $(window).width();
            if (windowWidth > 992) {
                document.write('<script type="text/javascript" src="/diary/libs/background/ribbon-dynamic.js"><\/script>');
            }
            </script>
        

    <script>
            window.imageLazyLoadSetting = {
                isSPA: false,
                preloadRatio: 1,
                processImages: null,
            };
        </script><script>window.addEventListener("load",function(){var t=/\.(gif|jpg|jpeg|tiff|png)$/i,r=/^data:image\/[a-z]+;base64,/;Array.prototype.slice.call(document.querySelectorAll("img[data-original]")).forEach(function(a){var e=a.parentNode;"A"===e.tagName&&(e.href.match(t)||e.href.match(r))&&(e.href=a.dataset.original)})});</script><script>!function(n){n.imageLazyLoadSetting.processImages=o;var e=n.imageLazyLoadSetting.isSPA,i=n.imageLazyLoadSetting.preloadRatio||1,r=Array.prototype.slice.call(document.querySelectorAll("img[data-original]"));function o(){e&&(r=Array.prototype.slice.call(document.querySelectorAll("img[data-original]")));for(var t,a=0;a<r.length;a++)0<=(t=(t=r[a]).getBoundingClientRect()).bottom&&0<=t.left&&t.top<=(n.innerHeight*i||document.documentElement.clientHeight*i)&&function(){var t,e,n,i,o=r[a];t=o,e=function(){r=r.filter(function(t){return o!==t})},n=new Image,i=t.getAttribute("data-original"),n.onload=function(){t.src=i,e&&e()},t.src!==i&&(n.src=i)}()}o(),n.addEventListener("scroll",function(){var t,e;t=o,e=n,clearTimeout(t.tId),t.tId=setTimeout(function(){t.call(e)},500)})}(this);</script></body>
</html>